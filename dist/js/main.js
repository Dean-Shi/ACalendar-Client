/*!
 * rrule.js - Library for working with recurrence rules for calendar dates.
 * https://github.com/jkbr/rrule
 *
 * Copyright 2010, Jakub Roztocil and Lars Schoning
 * Licenced under the BSD licence.
 * https://github.com/jkbr/rrule/blob/master/LICENCE
 *
 * Based on:
 * python-dateutil - Extensions to the standard Python datetime module.
 * Copyright (c) 2003-2011 - Gustavo Niemeyer <gustavo@niemeyer.net>
 * Copyright (c) 2012 - Tomi Pieviläinen <tomi.pievilainen@iki.fi>
 * https://github.com/jkbr/rrule/blob/master/LICENCE
 *
 * Modified by: Dean Shi
 * Changed: 
 *         1. Fixed loading AMD error
 *         2. Changed Sunday as the first day of the week
 */

/**
 * closure/goog/math/math.js:modulo
 * Copyright 2006 The Closure Library Authors.
 * The % operator in JavaScript returns the remainder of a / b, but differs from
 * some other languages in that the result will have the same sign as the
 * dividend. For example, -1 % 8 == -1, whereas in some other languages
 * (such as Python) the result would be 7. This function emulates the more
 * correct modulo behavior, which is useful for certain applications such as
 * calculating an offset index in a circular list.
 *
 * @param {number} a The dividend.
 * @param {number} b The divisor.
 * @return {number} a % b where the result is between 0 and b (either 0 <= x < b
 *     or b < x <= 0, depending on the sign of b).
 */

//     keymaster.js
//     (c) 2011-2012 Thomas Fuchs
//     keymaster.js may be freely distributed under the MIT license.

/*! jQuery UI - v1.10.3 - 2013-05-03
* http://jqueryui.com
* Copyright 2013 jQuery Foundation and other contributors; Licensed MIT */

(function(e,t){typeof exports!="undefined"?module.exports={RRule:t(e,require("underscore"))}:typeof define=="function"&&define.amd?define("rrule",["underscore"],function(n){return e.RRule=t(e,n)}):e.RRule=t(e,e._)})(this,function(e,t){var n=typeof module!="undefined"&&module.exports,r=function(){if(!r._nlp)if(n)r._nlp=require("./nlp");else if(!(r._nlp=e._RRuleNLP))throw"You need to include rrule/nlp.js for fromText/toText to work.";return r._nlp},i={MONTH_DAYS:[31,28,31,30,31,30,31,31,30,31,30,31],ONE_DAY:864e5,MAXYEAR:9999,ORDINAL_BASE:new Date(1970,0,1),PY_WEEKDAYS:[0,1,2,3,4,5,6],getYearDay:function(e){var t=new Date(e.getFullYear(),e.getMonth(),e.getDate());return Math.ceil((t-new Date(e.getFullYear(),0,1))/i.ONE_DAY)+1},isLeapYear:function(e){return e instanceof Date&&(e=e.getFullYear()),e%4===0&&e%100!==0||e%400===0},tzOffset:function(e){return e.getTimezoneOffset()*60*1e3},daysBetween:function(e,t){var n=e.getTime()-i.tzOffset(e),r=t.getTime()-i.tzOffset(t),s=Math.abs(n-r);return Math.round(s/i.ONE_DAY)},toOrdinal:function(e){return i.daysBetween(e,i.ORDINAL_BASE)},fromOrdinal:function(e){var t=e*i.ONE_DAY;return new Date(i.ORDINAL_BASE.getTime()-i.tzOffset(i.ORDINAL_BASE)+t+i.tzOffset(new Date(t)))},monthRange:function(e,t){var n=new Date(e,t,1);return[i.getWeekday(n),i.getMonthDays(n)]},getMonthDays:function(e){var t=e.getMonth();return t==1&&i.isLeapYear(e)?29:i.MONTH_DAYS[t]},getWeekday:function(e){return i.PY_WEEKDAYS[e.getDay()]},combine:function(e,t){return t=t||e,new Date(e.getFullYear(),e.getMonth(),e.getDate(),t.getHours(),t.getMinutes(),t.getSeconds())},clone:function(e){var t=new Date(e.getTime());return t.setMilliseconds(0),t},cloneDates:function(e){var t=[];for(var n=0;n<e.length;n++)t.push(i.clone(e[n]));return t},sort:function(e){e.sort(function(e,t){return e.getTime()-t.getTime()})},timeToUntilString:function(e){var t=new Date(e),n,r=[t.getUTCFullYear(),t.getUTCMonth()+1,t.getUTCDate(),"T",t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds(),"Z"];for(var i=0;i<r.length;i++)n=r[i],!/[TZ]/.test(n)&&n<10&&(r[i]="0"+String(n));return r.join("")},untilStringToDate:function(e){var t=/^(\d{4})(\d{2})(\d{2})(T(\d{2})(\d{2})(\d{2})Z)?$/,n=t.exec(e);if(!n)throw new Error("Invalid UNTIL value: "+e);return new Date(Date.UTC(n[1],n[2]-1,n[3],n[5]||0,n[6]||0,n[7]||0))}};i.Time=function(e,t,n){this.hour=e,this.minute=t,this.second=n},i.Time.prototype={getHours:function(){return this.hour},getMinutes:function(){return this.minute},getSeconds:function(){return this.second},getTime:function(){return(this.hour*60*60+this.minute*60+this.second)*1e3}};var s=function(e,t){arguments.length===1&&(t=e,e=0);var n=[];for(var r=e;r<t;r++)n.push(r);return n},o=function(e,t){var n=0,r=[];if(e instanceof Array)for(;n<t;n++)r[n]=[].concat(e);else for(;n<t;n++)r[n]=e;return r},u=function(e,t){var n=e%t;return n*t<0?n+t:n},a=function(e,t){return{div:Math.floor(e/t),mod:u(e,t)}},f=function(e){return e instanceof Array&&e.length==0?!1:Boolean(e)},l=[].concat(o(1,31),o(2,28),o(3,31),o(4,30),o(5,31),o(6,30),o(7,31),o(8,31),o(9,30),o(10,31),o(11,30),o(12,31),o(1,7)),c=[].concat(o(1,31),o(2,29),o(3,31),o(4,30),o(5,31),o(6,30),o(7,31),o(8,31),o(9,30),o(10,31),o(11,30),o(12,31),o(1,7)),h=s(1,29),p=s(1,30),d=s(1,31),v=s(1,32),m=[].concat(v,p,v,d,v,d,v,v,d,v,d,v,v.slice(0,7)),g=[].concat(v,h,v,d,v,d,v,v,d,v,d,v,v.slice(0,7));h=s(-28,0),p=s(-29,0),d=s(-30,0),v=s(-31,0);var y=[].concat(v,p,v,d,v,d,v,v,d,v,d,v,v.slice(0,7)),b=[].concat(v,h,v,d,v,d,v,v,d,v,d,v,v.slice(0,7)),w=[0,31,60,91,121,152,182,213,244,274,305,335,366],E=[0,31,59,90,120,151,181,212,243,273,304,334,365],S=function(){for(var e=[],t=0;t<55;t++)e=e.concat(s(7));return e}(),x=function(e,t){if(t===0)throw"Can't create weekday with n == 0";this.weekday=e,this.n=t};x.prototype={nth:function(e){return this.n==e?this:new x(this.weekday,e)},equals:function(e){return this.weekday==e.weekday&&this.n==e.n},toString:function(){var e=["SU","MO","TU","WE","TH","FR","SA"][this.weekday];return this.n&&(e=(this.n>0?"+":"")+String(this.n)+e),e},getJsWeekday:function(){return this.weekday==6?0:this.weekday+1}};var T=function(e,n){this._string=null;var r=t.clone(T.DEFAULT_OPTIONS);e=e||{},this._cache=n?null:{all:!1,before:[],after:[],between:[]};var s=t(e).chain().keys().reject(function(e){return t.has(r,e)}).value();if(s.length)throw"Invalid options: "+s.join(", ");if(!T.FREQUENCIES[e.freq]&&e.byeaster===null)throw"Invalid frequency: "+String(e.freq);this.origOptions=t.clone(e);var o;this.options=o=t.extend({},r,e),o.byeaster!==null&&(o.freq=T.YEARLY),o.dtstart||(o.dtstart=new Date,o.dtstart.setMilliseconds(0)),o.wkst===null?o.wkst=T.MO.weekday:typeof o.wkst!="number"&&(o.wkst=o.wkst.weekday);if(o.bysetpos!==null){typeof o.bysetpos=="number"&&(o.bysetpos=[o.bysetpos]);for(var u=0;u<o.bysetpos.length;u++){var a=o.bysetpos[u];if(a==0||!(-366<=a&&a<=366))throw"bysetpos must be between 1 and 366, or between -366 and -1"}}if(!(f(o.byweekno)||f(o.byyearday)||f(o.bymonthday)||f(o.byweekday)||o.byeaster!==null))switch(o.freq){case T.YEARLY:o.bymonth||(o.bymonth=o.dtstart.getMonth()+1),o.bymonthday=o.dtstart.getDate();break;case T.MONTHLY:o.bymonthday=o.dtstart.getDate();break;case T.WEEKLY:o.byweekday=i.getWeekday(o.dtstart)}o.bymonth!==null&&!(o.bymonth instanceof Array)&&(o.bymonth=[o.bymonth]),o.byyearday!==null&&!(o.byyearday instanceof Array)&&(o.byyearday=[o.byyearday]);if(o.bymonthday===null)o.bymonthday=[],o.bynmonthday=[];else if(o.bymonthday instanceof Array){var l=[],c=[];for(u=0;u<o.bymonthday.length;u++){var a=o.bymonthday[u];a>0?l.push(a):a<0&&c.push(a)}o.bymonthday=l,o.bynmonthday=c}else o.bymonthday<0?(o.bynmonthday=[o.bymonthday],o.bymonthday=[]):(o.bynmonthday=[],o.bymonthday=[o.bymonthday]);o.byweekno!==null&&!(o.byweekno instanceof Array)&&(o.byweekno=[o.byweekno]);if(o.byweekday===null)o.bynweekday=null;else if(typeof o.byweekday=="number")o.byweekday=[o.byweekday],o.bynweekday=null;else if(o.byweekday instanceof x)!o.byweekday.n||o.freq>T.MONTHLY?(o.byweekday=[o.byweekday.weekday],o.bynweekday=null):(o.bynweekday=[[o.byweekday.weekday,o.byweekday.n]],o.byweekday=null);else{var h=[],p=[];for(u=0;u<o.byweekday.length;u++){var d=o.byweekday[u];typeof d=="number"?h.push(d):!d.n||o.freq>T.MONTHLY?h.push(d.weekday):p.push([d.weekday,d.n])}o.byweekday=f(h)?h:null,o.bynweekday=f(p)?p:null}o.byhour===null?o.byhour=o.freq<T.HOURLY?[o.dtstart.getHours()]:null:typeof o.byhour=="number"&&(o.byhour=[o.byhour]),o.byminute===null?o.byminute=o.freq<T.MINUTELY?[o.dtstart.getMinutes()]:null:typeof o.byminute=="number"&&(o.byminute=[o.byminute]),o.bysecond===null?o.bysecond=o.freq<T.SECONDLY?[o.dtstart.getSeconds()]:null:typeof o.bysecond=="number"&&(o.bysecond=[o.bysecond]);if(o.freq>=T.HOURLY)this.timeset=null;else{this.timeset=[];for(u=0;u<o.byhour.length;u++){var v=o.byhour[u];for(var m=0;m<o.byminute.length;m++){var g=o.byminute[m];for(var y=0;y<o.bysecond.length;y++){var b=o.bysecond[y];this.timeset.push(new i.Time(v,g,b))}}}i.sort(this.timeset)}};T.FREQUENCIES=["YEARLY","MONTHLY","WEEKLY","DAILY","HOURLY","MINUTELY","SECONDLY"],T.YEARLY=0,T.MONTHLY=1,T.WEEKLY=2,T.DAILY=3,T.HOURLY=4,T.MINUTELY=5,T.SECONDLY=6,T.SU=new x(0),T.MO=new x(1),T.TU=new x(2),T.WE=new x(3),T.TH=new x(4),T.FR=new x(5),T.SA=new x(6),T.DEFAULT_OPTIONS={freq:null,dtstart:null,interval:1,wkst:T.SU,count:null,until:null,bysetpos:null,bymonth:null,bymonthday:null,byyearday:null,byweekno:null,byweekday:null,byhour:null,byminute:null,bysecond:null,byeaster:null},T.parseText=function(e,t){return r().parseText(e,t)},T.fromText=function(e,t){return r().fromText(e,t)},T.optionsToString=function(e){var n,r,s,o,u=[];r=t.intersection(t.keys(T.DEFAULT_OPTIONS),t.keys(e));for(var a=0;a<r.length;a++){n=r[a].toUpperCase(),s=e[r[a]],o=[];if(s===null||s instanceof Array&&!s.length)continue;switch(n){case"FREQ":s=T.FREQUENCIES[e.freq];break;case"WKST":s=s.toString();break;case"BYWEEKDAY":n="BYDAY",s instanceof Array||(s=[s]);for(var f,l=0;l<s.length;l++)f=s[l],f instanceof x||(f instanceof Array?f=new x(f[0],f[1]):f=new x(f)),o[l]=f.toString();s=o;break;case"DTSTART":case"UNTIL":s=i.timeToUntilString(s);break;default:if(s instanceof Array){for(var l=0;l<s.length;l++)o[l]=String(s[l]);s=o}else s=String(s)}u.push([n,s])}var c=[];for(var a=0;a<u.length;a++){var h=u[a];c.push(h[0]+"="+h[1].toString())}return c.join(";")},T.prototype={all:function(e){if(e)return this._iter(new k("all",{},e));var t=this._cacheGet("all");return t===!1&&(t=this._iter(new C("all",{})),this._cacheAdd("all",t)),t},between:function(e,t,n,r){var i={before:t,after:e,inc:n};if(r)return this._iter(new k("between",i,r));var s=this._cacheGet("between",i);return s===!1&&(s=this._iter(new C("between",i)),this._cacheAdd("between",s,i)),s},before:function(e,t){var n={dt:e,inc:t},r=this._cacheGet("before",n);return r===!1&&(r=this._iter(new C("before",n)),this._cacheAdd("before",r,n)),r},after:function(e,t){var n={dt:e,inc:t},r=this._cacheGet("after",n);return r===!1&&(r=this._iter(new C("after",n)),this._cacheAdd("after",r,n)),r},count:function(){return this.all().length},toString:function(){return T.optionsToString(this.origOptions)},toText:function(e,t){return r().toText(this,e,t)},isFullyConvertibleToText:function(){return r().isFullyConvertible(this)},_cacheAdd:function(e,t,n){if(!this._cache)return;t&&(t=t instanceof Date?i.clone(t):i.cloneDates(t)),e=="all"?this._cache.all=t:(n._value=t,this._cache[e].push(n))},_cacheGet:function(e,t){if(!this._cache)return!1;var n=!1;if(e=="all")n=this._cache.all;else e:for(var r,s=0;s<this._cache[e].length;s++){r=this._cache[e][s];for(var o in t)if(t.hasOwnProperty(o)&&String(t[o])!=String(r[o]))continue e;n=r._value;break}if(!n&&this._cache.all){var u=new C(e,t);for(var s=0;s<this._cache.all.length;s++)if(!u.accept(this._cache.all[s]))break;n=u.getValue(),this._cacheAdd(e,n,t)}return n instanceof Array?i.cloneDates(n):n instanceof Date?i.clone(n):n},clone:function(){return new T(this.origOptions)},_iter:function(e){var n=this.options.dtstart,r=n.getFullYear(),s=n.getMonth()+1,o=n.getDate(),l=n.getHours(),c=n.getMinutes(),h=n.getSeconds(),p=i.getWeekday(n),d=i.getYearDay(n),v=this.options.freq,m=this.options.interval,g=this.options.wkst,y=this.options.until,b=this.options.bymonth,w=this.options.byweekno,E=this.options.byyearday,S=this.options.byweekday,x=this.options.byeaster,C=this.options.bymonthday,k=this.options.bynmonthday,L=this.options.bysetpos,A=this.options.byhour,O=this.options.byminute,M=this.options.bysecond,D=new N(this);D.rebuild(r,s);var P={};P[T.YEARLY]=D.ydayset,P[T.MONTHLY]=D.mdayset,P[T.WEEKLY]=D.wdayset,P[T.DAILY]=D.ddayset,P[T.HOURLY]=D.ddayset,P[T.MINUTELY]=D.ddayset,P[T.SECONDLY]=D.ddayset,P=P[v];var H;if(v<T.HOURLY)H=this.timeset;else{var B={};B[T.HOURLY]=D.htimeset,B[T.MINUTELY]=D.mtimeset,B[T.SECONDLY]=D.stimeset,B=B[v],v>=T.HOURLY&&f(A)&&!t.include(A,l)||v>=T.MINUTELY&&f(O)&&!t.include(O,c)||v>=T.SECONDLY&&f(M)&&!t.include(M,c)?H=[]:H=B.call(D,l,c,h)}var j,F=0,I=this.options.count,q=0,R,U,z,W,X,V,$,J,K,Q,G,Y;for(;;){$=P.call(D,r,s,o),K=$[0],Q=$[1],G=$[2],j=!1;for(U=Q;U<G;U++){R=K[U];if(f(b)&&!t.include(b,D.mmask[R])||f(w)&&!D.wnomask[R]||f(S)&&!t.include(S,D.wdaymask[R])||f(D.nwdaymask)&&!D.nwdaymask[R]||x!==null&&!t.include(D.eastermask,R)||(f(C)||f(k))&&!t.include(C,D.mdaymask[R])&&!t.include(k,D.nmdaymask[R])||f(E)&&(R<D.yearlen&&!t.include(E,R+1)&&!t.include(E,-D.yearlen+R)||R>=D.yearlen&&!t.include(E,R+1-D.yearlen)&&!t.include(E,-D.nextyearlen+R-D.yearlen)))K[R]=null,j=!0}if(f(L)&&f(H)){var Z,et,tt=[];for(R,U=0;U<L.length;U++){var J=L[U];J<0?(Z=Math.floor(J/H.length),et=u(J,H.length)):(Z=Math.floor((J-1)/H.length),et=u(J-1,H.length));try{$=[];for(z=Q;z<G;z++){var nt=K[z];if(nt===null)continue;$.push(nt)}Z<0?R=$.slice(Z)[0]:R=$[Z];var rt=H[et],it=i.fromOrdinal(D.yearordinal+R),st=i.combine(it,rt);t.include(tt,st)||tt.push(st)}catch(ot){}}i.sort(tt);for(U=0;U<tt.length;U++){var st=tt[U];if(y&&st>y)return this._len=F,e.getValue();if(st>=n){++F;if(!e.accept(st))return e.getValue();if(I){--I;if(!I)return this._len=F,e.getValue()}}}}else for(U=Q;U<G;U++){R=K[U];if(R!==null){var it=i.fromOrdinal(D.yearordinal+R);for(z=0;z<H.length;z++){var rt=H[z],st=i.combine(it,rt);if(y&&st>y)return this._len=F,e.getValue();if(st>=n){++F;if(!e.accept(st))return e.getValue();if(I){--I;if(!I)return this._len=F,e.getValue()}}}}}Y=!1;if(v==T.YEARLY){r+=m;if(r>i.MAXYEAR)return this._len=F,e.getValue();D.rebuild(r,s)}else if(v==T.MONTHLY){s+=m;if(s>12){X=Math.floor(s/12),V=u(s,12),s=V,r+=X,s==0&&(s=12,--r);if(r>i.MAXYEAR)return this._len=F,e.getValue()}D.rebuild(r,s)}else if(v==T.WEEKLY)g>p?o+=-(p+1+(6-g))+m*7:o+=-(p-g)+m*7,p=g,Y=!0;else if(v==T.DAILY)o+=m,Y=!0;else if(v==T.HOURLY){j&&(l+=Math.floor((23-l)/m)*m);for(;;){l+=m,W=a(l,24),X=W.div,V=W.mod,X&&(l=V,o+=X,Y=!0);if(!f(A)||t.include(A,l))break}H=B.call(D,l,c,h)}else if(v==T.MINUTELY){j&&(c+=Math.floor((1439-(l*60+c))/m)*m);for(;;){c+=m,W=a(c,60),X=W.div,V=W.mod,X&&(c=V,l+=X,W=a(l,24),X=W.div,V=W.mod,X&&(l=V,o+=X,Y=!0,j=!1));if((!f(A)||t.include(A,l))&&(!f(O)||t.include(O,c)))break}H=B.call(D,l,c,h)}else if(v==T.SECONDLY){j&&(h+=Math.floor((86399-(l*3600+c*60+h))/m)*m);for(;;){h+=m,W=a(h,60),X=W.div,V=W.mod,X&&(h=V,c+=X,W=a(c,60),X=W.div,V=W.mod,X&&(c=V,l+=X,W=a(l,24),X=W.div,V=W.mod,X&&(l=V,o+=X,Y=!0)));if((!f(A)||t.include(A,l))&&(!f(O)||t.include(O,c))&&(!f(M)||t.include(M,h)))break}H=B.call(D,l,c,h)}if(Y&&o>28){var ut=i.monthRange(r,s-1)[1];if(o>ut){while(o>ut){o-=ut,++s;if(s==13){s=1,++r;if(r>i.MAXYEAR)return this._len=F,e.getValue()}ut=i.monthRange(r,s-1)[1]}D.rebuild(r,s)}}}}},T.parseString=function(e){e=e.replace(/^\s+|\s+$/,"");if(!e.length)return null;var t,n,r,s,o,u=e.split(";"),a={};for(t=0;t<u.length;t++){o=u[t].split("="),r=o[0],s=o[1];switch(r){case"FREQ":a.freq=T[s];break;case"WKST":a.wkst=T[s];break;case"COUNT":case"INTERVAL":case"BYSETPOS":case"BYMONTH":case"BYMONTHDAY":case"BYYEARDAY":case"BYWEEKNO":case"BYHOUR":case"BYMINUTE":case"BYSECOND":if(s.indexOf(",")!=-1){s=s.split(",");for(n=0;n<s.length;n++)/^[+-]?\d+$/.test(s[n])&&(s[n]=Number(s[n]))}else/^[+-]?\d+$/.test(s)&&(s=Number(s));r=r.toLowerCase(),a[r]=s;break;case"BYDAY":var f,l,c,h=s.split(",");a.byweekday=[];for(n=0;n<h.length;n++)c=h[n],c.length==2?(l=T[c],a.byweekday.push(l)):(c=c.match(/^([+-]?\d)([A-Z]{2})$/),f=Number(c[1]),l=c[2],l=T[l].weekday,a.byweekday.push(new x(l,f)));break;case"DTSTART":a.dtstart=i.untilStringToDate(s);break;case"UNTIL":a.until=i.untilStringToDate(s);break;case"BYEASTER":a.byeaster=Number(s);break;default:throw new Error("Unknown RRULE property '"+r+"'")}}return a},T.fromString=function(e){return new T(T.parseString(e))};var N=function(e){this.rrule=e,this.lastyear=null,this.lastmonth=null,this.yearlen=null,this.nextyearlen=null,this.yearordinal=null,this.yearweekday=null,this.mmask=null,this.mrange=null,this.mdaymask=null,this.nmdaymask=null,this.wdaymask=null,this.wnomask=null,this.nwdaymask=null,this.eastermask=null};N.prototype.easter=function(e,t){t=t||0;var n=e%19,r=Math.floor(e/100),i=e%100,s=Math.floor(r/4),o=r%4,u=Math.floor((r+8)/25),a=Math.floor((r-u+1)/3),f=Math.floor(19*n+r-s-a+15)%30,l=Math.floor(i/4),c=i%4,h=Math.floor(32+2*o+2*l-f-c)%7,p=Math.floor((n+11*f+22*h)/451),d=Math.floor((f+h-7*p+114)/31),v=(f+h-7*p+114)%31+1,m=Date.UTC(e,d-1,v+t),g=Date.UTC(e,0,1);return[Math.ceil((m-g)/864e5)]},N.prototype.rebuild=function(e,n){var r=this.rrule;if(e!=this.lastyear){this.yearlen=i.isLeapYear(e)?366:365,this.nextyearlen=i.isLeapYear(e+1)?366:365;var s=new Date(e,0,1);this.yearordinal=i.toOrdinal(s),this.yearweekday=i.getWeekday(s);var a=i.getWeekday(new Date(e,0,1));this.yearlen==365?(this.mmask=[].concat(l),this.mdaymask=[].concat(g),this.nmdaymask=[].concat(b),this.wdaymask=S.slice(a),this.mrange=[].concat(E)):(this.mmask=[].concat(c),this.mdaymask=[].concat(m),this.nmdaymask=[].concat(y),this.wdaymask=S.slice(a),this.mrange=[].concat(w));if(!f(r.options.byweekno))this.wnomask=null;else{this.wnomask=o(0,this.yearlen+7);var h,p,d;h=p=u(7-this.yearweekday+r.options.wkst,7),h>=4?(h=0,d=this.yearlen+u(this.yearweekday-r.options.wkst,7)):d=this.yearlen-h;var v=Math.floor(d/7),x=u(d,7),N=Math.floor(v+x/4);for(var C,k,L=0;L<r.options.byweekno.length;L++){C=r.options.byweekno[L],C<0&&(C+=N+1);if(!(0<C&&C<=N))continue;C>1?(k=h+(C-1)*7,h!=p&&(k-=7-p)):k=h;for(var A=0;A<7;A++){this.wnomask[k]=1,k++;if(this.wdaymask[k]==r.options.wkst)break}}if(t.include(r.options.byweekno,1)){var k=h+N*7;h!=p&&(k-=7-p);if(k<this.yearlen)for(var L=0;L<7;L++){this.wnomask[k]=1,k+=1;if(this.wdaymask[k]==r.options.wkst)break}}if(h){var O;if(!t.include(r.options.byweekno,-1)){var M=i.getWeekday(new Date(e-1,0,1)),D=u(7-M+r.options.wkst,7),P=i.isLeapYear(e-1)?366:365;D>=4?(D=0,O=Math.floor(52+u(P+u(M-r.options.wkst,7),7)/4)):O=Math.floor(52+u(this.yearlen-h,7)/4)}else O=-1;if(t.include(r.options.byweekno,O))for(var k=0;k<h;k++)this.wnomask[k]=1}}}if(f(r.options.bynweekday)&&(n!=this.lastmonth||e!=this.lastyear)){var H=[];if(r.options.freq==T.YEARLY)if(f(r.options.bymonth))for(L=0;L<r.options.bymonth.length;L++)n=r.options.bymonth[L],H.push(this.mrange.slice(n-1,n+1));else H=[[0,this.yearlen]];else r.options.freq==T.MONTHLY&&(H=[this.mrange.slice(n-1,n+1)]);if(f(H)){this.nwdaymask=o(0,this.yearlen);for(var L=0;L<H.length;L++){var B=H[L],j=B[0],F=B[1];F-=1;for(var A=0;A<r.options.bynweekday.length;A++){var a=r.options.bynweekday[A][0],C=r.options.bynweekday[A][1];C<0?(k=F+(C+1)*7,k-=u(this.wdaymask[k]-a,7)):(k=j+(C-1)*7,k+=u(7-this.wdaymask[k]+a,7)),j<=k&&k<=F&&(this.nwdaymask[k]=1)}}}this.lastyear=e,this.lastmonth=n}r.options.byeaster!==null&&(this.eastermask=this.easter(e,r.options.byeaster))},N.prototype.ydayset=function(e,t,n){return[s(this.yearlen),0,this.yearlen]},N.prototype.mdayset=function(e,t,n){var r=o(null,this.yearlen),i=this.mrange[t-1],s=this.mrange[t];for(var u=i;u<s;u++)r[u]=u;return[r,i,s]},N.prototype.wdayset=function(e,t,n){var r=o(null,this.yearlen+7),s=i.toOrdinal(new Date(e,t-1,n))-this.yearordinal,u=s;for(var a=0;a<7;a++){r[s]=s,++s;if(this.wdaymask[s]==this.rrule.options.wkst)break}return[r,u,s]},N.prototype.ddayset=function(e,t,n){var r=o(null,this.yearlen),s=i.toOrdinal(new Date(e,t-1,n))-this.yearordinal;return r[s]=s,[r,s,s+1]},N.prototype.htimeset=function(e,t,n){var r=[],s=this.rrule;for(var o=0;o<s.options.byminute.length;o++){t=s.options.byminute[o];for(var u=0;u<s.options.bysecond.length;u++)n=s.options.bysecond[u],r.push(new i.Time(e,t,n))}return i.sort(r),r},N.prototype.mtimeset=function(e,t,n){var r=[],s=this.rrule;for(var o=0;o<s.options.bysecond.length;o++)n=s.options.bysecond[o],r.push(new i.Time(e,t,n));return i.sort(r),r},N.prototype.stimeset=function(e,t,n){return[new i.Time(e,t,n)]};var C=function(e,t){this.init(e,t)};C.prototype={init:function(e,t){this.method=e,this.args=t,this._result=[],this.minDate=null,this.maxDate=null,e=="between"?(this.maxDate=t.inc?t.before:new Date(t.before.getTime()-1),this.minDate=t.inc?t.after:new Date(t.after.getTime()+1)):e=="before"?this.maxDate=t.inc?t.dt:new Date(t.dt.getTime()-1):e=="after"&&(this.minDate=t.inc?t.dt:new Date(t.dt.getTime()+1))},accept:function(e){var t=this.minDate&&e<this.minDate,n=this.maxDate&&e>this.maxDate;if(this.method=="between"){if(t)return!0;if(n)return!1}else if(this.method=="before"){if(n)return!1}else if(this.method=="after")return t?!0:(this.add(e),!1);return this.add(e)},add:function(e){return this._result.push(e),!0},getValue:function(){switch(this.method){case"all":case"between":return this._result;case"before":case"after":return this._result.length?this._result[this._result.length-1]:null}}};var k=function(e,n,r){var i=["all","between"];if(!t.include(i,e))throw'Invalid method "'+e+'". Only all and between works with iterator.';this.add=function(e){return r(e,this._result.length)?(this._result.push(e),!0):!1},this.init(e,n)};return k.prototype=C.prototype,T}),function(e){function t(e,t){var n=e.length;while(n--)if(e[n]===t)return n;return-1}function n(e,t){if(e.length!=t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function r(e){for(b in E)E[b]=e[k[b]]}function i(e,n){var i,s,o,a,f;i=e.keyCode,t(C,i)==-1&&C.push(i);if(i==93||i==224)i=91;if(i in E){E[i]=!0;for(o in x)x[o]==i&&(u[o]=!0);return}r(e);if(!u.filter.call(this,e))return;if(!(i in w))return;for(a=0;a<w[i].length;a++){s=w[i][a];if(s.scope==n||s.scope=="all"){f=s.mods.length>0;for(o in E)if(!E[o]&&t(s.mods,+o)>-1||E[o]&&t(s.mods,+o)==-1)f=!1;(s.mods.length==0&&!E[16]&&!E[18]&&!E[17]&&!E[91]||f)&&s.method(e,s)===!1&&(e.preventDefault?e.preventDefault():e.returnValue=!1,e.stopPropagation&&e.stopPropagation(),e.cancelBubble&&(e.cancelBubble=!0))}}}function s(e){var n=e.keyCode,r,i=t(C,n);i>=0&&C.splice(i,1);if(n==93||n==224)n=91;if(n in E){E[n]=!1;for(r in x)x[r]==n&&(u[r]=!1)}}function o(){for(b in E)E[b]=!1;for(b in x)u[b]=!1}function u(e,t,n){var r,i,s,o;r=v(e),n===undefined&&(n=t,t="all");for(s=0;s<r.length;s++)i=[],e=r[s].split("+"),e.length>1&&(i=m(e),e=[e[e.length-1]]),e=e[0],e=N(e),e in w||(w[e]=[]),w[e].push({shortcut:r[s],scope:t,method:n,key:r[s],mods:i})}function a(e,t){var r=e.split("+"),i=[],s,o;r.length>1&&(i=m(r),e=r[r.length-1]),e=N(e),t===undefined&&(t=p());if(!w[e])return;for(s in w[e])o=w[e][s],o.scope===t&&n(o.mods,i)&&(w[e][s]={})}function f(e){return typeof e=="string"&&(e=N(e)),t(C,e)!=-1}function l(){return C.slice(0)}function c(e){var t=(e.target||e.srcElement).tagName;return t!="INPUT"&&t!="SELECT"&&t!="TEXTAREA"}function h(e){S=e||"all"}function p(){return S||"all"}function d(e){var t,n,r;for(t in w){n=w[t];for(r=0;r<n.length;)n[r].scope===e?n.splice(r,1):r++}}function v(e){var t;return e=e.replace(/\s/g,""),t=e.split(","),t[t.length-1]==""&&(t[t.length-2]+=","),t}function m(e){var t=e.slice(0,e.length-1);for(mi=0;mi<t.length;mi++)t[mi]=x[t[mi]];return t}function g(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,function(){n(window.event)})}function y(){var t=e.key;return e.key=L,t}var b,w={},E={16:!1,18:!1,17:!1,91:!1},S="all",x={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,command:91},T={backspace:8,tab:9,clear:12,enter:13,"return":13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,"delete":46,home:36,end:35,pageup:33,pagedown:34,",":188,".":190,"/":191,"`":192,"-":189,"=":187,";":186,"'":222,"[":219,"]":221,"\\":220},N=function(e){return T[e]||e.toUpperCase().charCodeAt(0)},C=[];for(b=1;b<20;b++)T["f"+b]=111+b;var k={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey"};for(b in x)u[b]=!1;g(document,"keydown",function(e){i(e,S)}),g(document,"keyup",s),g(window,"focus",o);var L=e.key;e.key=u,e.key.setScope=h,e.key.getScope=p,e.key.deleteScope=d,e.key.filter=c,e.key.isPressed=f,e.key.getPressedKeyCodes=l,e.key.noConflict=y,e.key.unbind=a,typeof module!="undefined"&&(module.exports=key)}(this),define("keymaster",function(e){return function(){var t,n;return t||e.key}}(this)),function(){var e;e=function(e){return this.cid=_.uniqueId("backbone.shortcuts"),this.initialize.apply(this,arguments),this.delegateShortcuts()},_.extend(e.prototype,Backbone.Events,{initialize:function(){},delegateShortcuts:function(){var e,t,n,r,i,s,o,u;if(!this.shortcuts)return;o=this.shortcuts,u=[];for(i in o){e=o[i],_.isFunction(e)||(n=this[e]);if(!n)throw new Error("Method "+e+" does not exist");t=i.match(/^(\S+)\s*(.*)$/),s=t[1],r=t[2]===""?"all":t[2],n=_.bind(n,this),u.push(key(s,r,n))}return u}}),Backbone.Shortcuts=e,Backbone.Shortcuts.extend=Backbone.View.extend}.call(this),define("shortcuts",function(){}),define("views/EventEditor",["jquery","underscore","backbone","moment","rrule","bootstrap","daterangepicker","datepicker","icheck","shortcuts"],function(e,t,n,r,i){var s=function(e){var t="",n=["years","months","weeks","days"],r=["Annually","Monthly","Weekly","Daily"],s=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],o=["January","February","March","April","May","June","July","August","September","October","November","December"];e.interval===1?t+=r[e.freq]:t+="Every "+e.interval+" "+n[e.freq];if(i.WEEKLY===e.freq){t+=" on ";if(e.byweekday.length===s.length)t+="all days";else if(e.byweekday.length===0)t+="[Missing days]";else{var u=e.byweekday.length-1;for(var a=0;a<u;a++){var f=e.byweekday[a];t+=s[f]+", "}var f=e.byweekday[u];t+=s[f]}}else if(i.MONTHLY===e.freq){t+=" on day ";var l=e.dtstart;t+=l.getDate()}else if(i.YEARLY===e.freq){t+=" on ";var l=e.dtstart;t+=o[l.getMonth()]+" "+l.getDate()}return e.count?e.count===1?t="Once":t+=", "+e.count+" times":e.until&&(t+=", until "+(new Date(e.until)).toDateString()),t},o=n.View.extend({el:"#dialog",initialize:function(e){var n=this;this.editorPanel=e.editorPanel,this.rrule=e.rrule,this.dtstart=e.dtstart,this.isNewRepeat=t.isNull(this.rrule),this.isNewRepeat&&(this.rrule={freq:i.WEEKLY,interval:1,byweekday:[],dtstart:this.dtstart},this.rrule.byweekday.push(this.rrule.dtstart.getDay())),this.$el.modal({backdrop:!1})},render:function(e,n){t.isUndefined(e)||(this.rrule=e.rrule||this.rrule,this.rrule.dtstart=e.dtstart||this.rrule.dtstart),this.renderPanel(),this.registerRepeatFreq(),this.registerRepeatInterval(),this.registerRepeatOn(),this.registerRepeatEnd(),this.registerButtons(),this.showSummaryOnDialog(),!t.isUndefined(n)&&t.isFunction(n)&&n()},showSummaryOnDialog:function(){var e=s(this.rrule);this.$("#repeat-summary").html(e)},renderPanel:function(){var n=t.template(e("#repeatDialogTemplate").html(),{rrule:this.rrule,isNewRepeat:this.isNewRepeat});this.$(".modal-content").html(n)},registerRepeatFreq:function(){var t=this;t.$("#repeat-frequency").on("change",function(){t.rrule.freq=parseInt(e(this).val()),t.render()})},registerRepeatInterval:function(){var t=this;t.$("#repeat-interval").on("change",function(){t.rrule.interval=parseInt(e(this).val()),t.showSummaryOnDialog()})},registerRepeatOn:function(){var n=this;this.$("#repeat-on button").on("click",function(){e(this).toggleClass("active");var r=parseInt(this.getAttribute("data-index"));e(this).hasClass("active")?(n.rrule.byweekday.push(r),n.rrule.byweekday.sort()):(console.log(r+": "+n.rrule.byweekday.toString()),n.rrule.byweekday=t.without(n.rrule.byweekday,r),console.log(t.without(n.rrule.byweekday,r))),n.showSummaryOnDialog()})},registerRepeatEnd:function(){var t=this,n=this.$("#repeat-ends-never"),r=this.$("#repeat-ends-count"),i=this.$("#repeat-ends-count_input"),s=this.$("#repeat-ends-until"),o=this.$("#repeat-ends-until_input");e(".modal .repeat-ends-option input").iCheck({checkboxClass:"icheckbox_square-green",radioClass:"iradio_square-green",increaseArea:"20%"}),n.on("ifChecked",function(e){i.attr("disabled","disabled"),o.attr("disabled","disabled"),t.rrule.until=null,t.rrule.count=null,t.showSummaryOnDialog()}),r.on("ifChecked",function(e){i.removeAttr("disabled"),o.attr("disabled","disabled"),t.rrule.until=null,t.rrule.count=parseInt(i.val()),t.showSummaryOnDialog()}),s.on("ifChecked",function(e){o.removeAttr("disabled"),i.attr("disabled","disabled"),t.rrule.until=new Date(o.val()),t.rrule.count=null,t.showSummaryOnDialog()}),o.datepicker({autoclose:!0,startDate:t.rrule.dtstart||t.acalEvent.start}).on("changeDate",function(e){t.rrule.until=e.date,t.showSummaryOnDialog()}).on("hide",function(){hidingDatepicker=!0}),i.on("change",function(){var e=parseInt(i.val());e<=0&&(e=1,i.val(e)),t.rrule.count=e,t.showSummaryOnDialog()})},registerButtons:function(){var e=this,n=this.$("#repeat-done"),r=this.$("#repeat-close"),s=!t.isNull(this.rrule),o=t.once(function(){s=!0});n.on("click",function(){if(i.WEEKLY===e.rrule.freq&&0===e.rrule.byweekday.length){alert("Cannot add this repeating event without setting any by day.");return}o(),e.editorPanel.trigger("rruleUpdate",e.rrule),e.$el.modal("hide")}),r.on("click",function(){console.log(s),(e.isNewRepeat||!s)&&e.editorPanel.trigger("cancelRepeat")})}});return n.View.extend({el:"#editor-panel",events:{"click #event-save":"save","click #event-return":"close","click #event-delete":"delete"},shortcuts:{"shift+enter":"save",esc:"close"},initialize:function(){t.extend(this,new n.Shortcuts),this.delegateShortcuts()},render:function(){this.$el.show(),this.acalEvent=this.model,this.rrule=this.acalEvent.get("rrule"),this.dtstart=this.acalEvent.get("start"),this.isNewRepeat=t.isNull(this.rrule),this.renderEditorTemplate(this.acalEvent);var e=this,n=e.$("#repeat-dialog"),r=!1;e.registerDaterangepicker(),e.registerRepeatDialog(),e.registerCheckbox()},renderEditorTemplate:function(n){var i=n.get("start").toString(),s=n.get("end")?n.get("end").toString():i,o=r(i).format("YYYY/MM/DD h:mm A")+" - "+r(s).format("YYYY/MM/DD h:mm A"),u=r(i).format("YYYY/MM/DD")+" - "+r(s).format("YYYY/MM/DD"),a=t.template(e("#eventEditorTemplate").html(),{event:n.toJSON(),dateTimeRange:o,dateRange:u});this.$el.html(a)},registerDaterangepicker:function(){function r(t,n){e.acalEvent.set("start",new Date(t)),e.acalEvent.set("end",new Date(n))}var e=this,t=e.$("#date-time-range"),n=e.$("#date-range");t.daterangepicker({timePicker:!0,timePickerIncrement:30,format:"YYYY/MM/DD h:mm A"},function(e,t){n.val(e.format("YYYY/MM/DD")+" - "+t.format("YYYY/MM/DD")),r(e,t)}),n.daterangepicker({format:"YYYY/MM/DD"},function(e,n){t.val(e.format("YYYY/MM/DD h:mm A")+" - "+n.format("YYYY/MM/DD h:mm A")),r(e,n)})},registerCheckbox:function(){function l(e){var t=e,n=t.next(),r=n.text();n.remove(),t.iCheck({checkboxClass:"icheckbox_line-blue",radioClass:"iradio_line-blue",insert:'<div class="icheck_line-icon"></div>'+r})}var e=this,n=this.acalEvent.get("rrule"),r=!t.isNull(n),i=this.$("#event-repeat-summary-area"),s=this.$("#event-repeat-edit"),o=e.$("#date-time-range"),u=e.$("#date-range"),a=this.$("#check-allday"),f=this.$("#check-repeat");l(a),l(f);var c=t.once(function(){s.on("click",function(){e.isNewRepeat||e.repeatDialog.render({dtstart:e.acalEvent.get("start")}),e.repeatDialog.$el.modal("show"),console.log(e.rrule)})}),h=t.once(function(){r=!0});a.on("ifToggled",function(){u.toggle(),o.toggle(),e.acalEvent.set("allDay",!e.acalEvent.get("allDay"))}),f.on("ifChecked",function(t){r?i.show():(e.isNewRepeat&&e.repeatDialog.render({dtstart:e.acalEvent.get("start")}),e.repeatDialog.$el.modal("show")),e.rrule=n}),f.on("ifUnchecked",function(t){i.hide(),e.rrule=null}),r&&(this.showSummaryOnPanel(n),f.iCheck("check"),c()),this.listenTo(this,"rruleUpdate",function(t){h(),console.log(r),e.rrule=n=t,e.showSummaryOnPanel(n),i.show(),c()}),this.listenTo(this,"cancelRepeat",function(){f.iCheck("uncheck")})},registerRepeatDialog:function(){this.repeatDialog=new o({editorPanel:this,rrule:this.rrule,dtstart:this.dtstart})},showSummaryOnPanel:function(e){var t=s(e);this.$("#event-repeat-summary-text").html(t)},generateId:function(){return(new Date).getTime().toString()},isBlank:function(e){return/^\s*$/.test(e)},close:function(){e("#main-panel").show(),this.calendarView.trigger("show"),this.$el.hide(),e(".daterangepicker").remove(),e(".modal-body table").children().remove()},save:function(){var e=this.$("#event-title-input").val(),n=this.$("#event-location-input").val(),r=this.$("#event-description-input").val();if(e===""&&!confirm("Are you sure you want to save this event without title?"))return;t.isNull(this.rrule)||(this.rrule.dtstart=this.acalEvent.get("start")),this.acalEvent.set({title:e||"Untitled Event",allDay:this.acalEvent.get("allDay"),start:this.acalEvent.get("start"),end:this.acalEvent.get("end"),rrule:this.rrule,last_modified:new Date,location:this.isBlank(n)?null:n,description:this.isBlank(r)?null:r}),this.acalEvent.isNew()?(this.acalEvent.set({_id:this.generateId()}),this.collection.create(this.acalEvent,{success:this.close()})):(this.acalEvent.save({},{success:this.close()}),this.collection.trigger("update",this.acalEvent))},"delete":function(){confirm("Are you sure you want to delete this event?")&&this.acalEvent.destroy({success:this.close()})}})}),define("models/Event",["backbone"],function(e){return e.Model.extend({idAttribute:"_id"})}),define("collections/Events",["backbone","models/Event"],function(e,t){return e.Collection.extend({model:t,url:"event"})}),define("modules/Backbone.sync",["underscore","backbone","bongo"],function(e,t,n){n.db({name:"calendar",collections:["local"]}),t.sync=function(e,t,r){var i=t.toJSON(),s=n.db("calendar").collection("local"),o=function(){var e=null;s.find({}).toArray(function(e,t){e||r.success(t)})},u=function(e){s.save(i,function(t,n){t||(console.log(e+" event in db: "+n),r.success(i))})},a=function(){s.remove(i._id.toString(),function(e){e||console.log("delete event in db: "+i._id)})};switch(e){case"create":case"update":u(e);break;case"read":o();break;case"delete":a()}}}),function(e,t){function n(t,n){var i,s,o,u=t.nodeName.toLowerCase();return"area"===u?(i=t.parentNode,s=i.name,t.href&&s&&"map"===i.nodeName.toLowerCase()?(o=e("img[usemap=#"+s+"]")[0],!!o&&r(o)):!1):(/input|select|textarea|button|object/.test(u)?!t.disabled:"a"===u?t.href||n:n)&&r(t)}function r(t){return e.expr.filters.visible(t)&&!e(t).parents().addBack().filter(function(){return"hidden"===e.css(this,"visibility")}).length}var i=0,s=/^ui-id-\d+$/;e.ui=e.ui||{},e.extend(e.ui,{version:"1.10.3",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.fn.extend({focus:function(t){return function(n,r){return"number"==typeof n?this.each(function(){var t=this;setTimeout(function(){e(t).focus(),r&&r.call(t)},n)}):t.apply(this,arguments)}}(e.fn.focus),scrollParent:function(){var t;return t=e.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(e.css(this,"position"))&&/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!t.length?e(document):t},zIndex:function(n){if(n!==t)return this.css("zIndex",n);if(this.length)for(var r,i,s=e(this[0]);s.length&&s[0]!==document;){if(r=s.css("position"),("absolute"===r||"relative"===r||"fixed"===r)&&(i=parseInt(s.css("zIndex"),10),!isNaN(i)&&0!==i))return i;s=s.parent()}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++i)})},removeUniqueId:function(){return this.each(function(){s.test(this.id)&&e(this).removeAttr("id")})}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(n){return!!e.data(n,t)}}):function(t,n,r){return!!e.data(t,r[3])},focusable:function(t){return n(t,!isNaN(e.attr(t,"tabindex")))},tabbable:function(t){var r=e.attr(t,"tabindex"),i=isNaN(r);return(i||r>=0)&&n(t,!i)}}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],function(n,r){function i(t,n,r,i){return e.each(s,function(){n-=parseFloat(e.css(t,"padding"+this))||0,r&&(n-=parseFloat(e.css(t,"border"+this+"Width"))||0),i&&(n-=parseFloat(e.css(t,"margin"+this))||0)}),n}var s="Width"===r?["Left","Right"]:["Top","Bottom"],o=r.toLowerCase(),u={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+r]=function(n){return n===t?u["inner"+r].call(this):this.each(function(){e(this).css(o,i(this,n)+"px")})},e.fn["outer"+r]=function(t,n){return"number"!=typeof t?u["outer"+r].call(this,t):this.each(function(){e(this).css(o,i(this,t,!0,n)+"px")})}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(e.fn.removeData=function(t){return function(n){return arguments.length?t.call(this,e.camelCase(n)):t.call(this)}}(e.fn.removeData)),e.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),e.support.selectstart="onselectstart"in document.createElement("div"),e.fn.extend({disableSelection:function(){return this.bind((e.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(e){e.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),e.extend(e.ui,{plugin:{add:function(t,n,r){var i,s=e.ui[t].prototype;for(i in r)s.plugins[i]=s.plugins[i]||[],s.plugins[i].push([n,r[i]])},call:function(e,t,n){var r,i=e.plugins[t];if(i&&e.element[0].parentNode&&11!==e.element[0].parentNode.nodeType)for(r=0;i.length>r;r++)e.options[i[r][0]]&&i[r][1].apply(e.element,n)}},hasScroll:function(t,n){if("hidden"===e(t).css("overflow"))return!1;var r=n&&"left"===n?"scrollLeft":"scrollTop",i=!1;return t[r]>0?!0:(t[r]=1,i=t[r]>0,t[r]=0,i)}})}(jQuery),function(e,t){var n=0,r=Array.prototype.slice,i=e.cleanData;e.cleanData=function(t){for(var n,r=0;null!=(n=t[r]);r++)try{e(n).triggerHandler("remove")}catch(s){}i(t)},e.widget=function(n,r,i){var s,o,u,a,f={},l=n.split(".")[0];n=n.split(".")[1],s=l+"-"+n,i||(i=r,r=e.Widget),e.expr[":"][s.toLowerCase()]=function(t){return!!e.data(t,s)},e[l]=e[l]||{},o=e[l][n],u=e[l][n]=function(e,n){return this._createWidget?(arguments.length&&this._createWidget(e,n),t):new u(e,n)},e.extend(u,o,{version:i.version,_proto:e.extend({},i),_childConstructors:[]}),a=new r,a.options=e.widget.extend({},a.options),e.each(i,function(n,i){return e.isFunction(i)?(f[n]=function(){var e=function(){return r.prototype[n].apply(this,arguments)},t=function(e){return r.prototype[n].apply(this,e)};return function(){var n,r=this._super,s=this._superApply;return this._super=e,this._superApply=t,n=i.apply(this,arguments),this._super=r,this._superApply=s,n}}(),t):(f[n]=i,t)}),u.prototype=e.widget.extend(a,{widgetEventPrefix:o?a.widgetEventPrefix:n},f,{constructor:u,namespace:l,widgetName:n,widgetFullName:s}),o?(e.each(o._childConstructors,function(t,n){var r=n.prototype;e.widget(r.namespace+"."+r.widgetName,u,n._proto)}),delete o._childConstructors):r._childConstructors.push(u),e.widget.bridge(n,u)},e.widget.extend=function(n){for(var i,o,u=r.call(arguments,1),a=0,f=u.length;f>a;a++)for(i in u[a])o=u[a][i],u[a].hasOwnProperty(i)&&o!==t&&(n[i]=e.isPlainObject(o)?e.isPlainObject(n[i])?e.widget.extend({},n[i],o):e.widget.extend({},o):o);return n},e.widget.bridge=function(n,i){var o=i.prototype.widgetFullName||n;e.fn[n]=function(u){var f="string"==typeof u,l=r.call(arguments,1),c=this;return u=!f&&l.length?e.widget.extend.apply(null,[u].concat(l)):u,f?this.each(function(){var r,i=e.data(this,o);return i?e.isFunction(i[u])&&"_"!==u.charAt(0)?(r=i[u].apply(i,l),r!==i&&r!==t?(c=r&&r.jquery?c.pushStack(r.get()):r,!1):t):e.error("no such method '"+u+"' for "+n+" widget instance"):e.error("cannot call methods on "+n+" prior to initialization; "+"attempted to call method '"+u+"'")}):this.each(function(){var t=e.data(this,o);t?t.option(u||{})._init():e.data(this,o,new i(u,this))}),c}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(t,r){r=e(r||this.defaultElement||this)[0],this.element=e(r),this.uuid=n++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this.bindings=e(),this.hoverable=e(),this.focusable=e(),r!==this&&(e.data(r,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===r&&this.destroy()}}),this.document=e(r.style?r.ownerDocument:r.document||r),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(n,r){var i,s,o,u=n;if(0===arguments.length)return e.widget.extend({},this.options);if("string"==typeof n)if(u={},i=n.split("."),n=i.shift(),i.length){for(s=u[n]=e.widget.extend({},this.options[n]),o=0;i.length-1>o;o++)s[i[o]]=s[i[o]]||{},s=s[i[o]];if(n=i.pop(),r===t)return s[n]===t?null:s[n];s[n]=r}else{if(r===t)return this.options[n]===t?null:this.options[n];u[n]=r}return this._setOptions(u),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,"disabled"===e&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!t).attr("aria-disabled",t),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(n,r,i){var s,o=this;"boolean"!=typeof n&&(i=r,r=n,n=!1),i?(r=s=e(r),this.bindings=this.bindings.add(r)):(i=r,r=this.element,s=this.widget()),e.each(i,function(i,u){function f(){return n||o.options.disabled!==!0&&!e(this).hasClass("ui-state-disabled")?("string"==typeof u?o[u]:u).apply(o,arguments):t}"string"!=typeof u&&(f.guid=u.guid=u.guid||f.guid||e.guid++);var l=i.match(/^(\w+)\s*(.*)$/),c=l[1]+o.eventNamespace,h=l[2];h?s.delegate(h,c,f):r.bind(c,f)})},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(t).undelegate(t)},_delay:function(e,t){function n(){return("string"==typeof e?r[e]:e).apply(r,arguments)}var r=this;return setTimeout(n,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,n,r){var i,s,o=this.options[t];if(r=r||{},n=e.Event(n),n.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),n.target=this.element[0],s=n.originalEvent)for(i in s)i in n||(n[i]=s[i]);return this.element.trigger(n,r),!(e.isFunction(o)&&o.apply(this.element[0],[n].concat(r))===!1||n.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,n){e.Widget.prototype["_"+t]=function(r,i,s){"string"==typeof i&&(i={effect:i});var o,u=i?i===!0||"number"==typeof i?n:i.effect||n:t;i=i||{},"number"==typeof i&&(i={duration:i}),o=!e.isEmptyObject(i),i.complete=s,i.delay&&r.delay(i.delay),o&&e.effects&&e.effects.effect[u]?r[t](i):u!==t&&r[u]?r[u](i.duration,i.easing,s):r.queue(function(n){e(this)[t](),s&&s.call(r[0]),n()})}})}(jQuery),function(e){var t=!1;e(document).mouseup(function(){t=!1}),e.widget("ui.mouse",{version:"1.10.3",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(n){return!0===e.data(n.target,t.widgetName+".preventClickEvent")?(e.removeData(n.target,t.widgetName+".preventClickEvent"),n.stopImmediatePropagation(),!1):undefined}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(n){if(!t){this._mouseStarted&&this._mouseUp(n),this._mouseDownEvent=n;var r=this,i=1===n.which,s="string"==typeof this.options.cancel&&n.target.nodeName?e(n.target).closest(this.options.cancel).length:!1;return i&&!s&&this._mouseCapture(n)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){r.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(n)&&this._mouseDelayMet(n)&&(this._mouseStarted=this._mouseStart(n)!==!1,!this._mouseStarted)?(n.preventDefault(),!0):(!0===e.data(n.target,this.widgetName+".preventClickEvent")&&e.removeData(n.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return r._mouseMove(e)},this._mouseUpDelegate=function(e){return r._mouseUp(e)},e(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),n.preventDefault(),t=!0,!0)):!0}},_mouseMove:function(t){return e.ui.ie&&(!document.documentMode||9>document.documentMode)&&!t.button?this._mouseUp(t):this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==!1,this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted)},_mouseUp:function(t){return e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target===this._mouseDownEvent.target&&e.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}(jQuery),function(e){e.widget("ui.draggable",e.ui.mouse,{version:"1.10.3",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"!==this.options.helper||/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},_destroy:function(){this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy()},_mouseCapture:function(t){var n=this.options;return this.helper||n.disabled||e(t.target).closest(".ui-resizable-handle").length>0?!1:(this.handle=this._getHandle(t),this.handle?(e(n.iframeFix===!0?"iframe":n.iframeFix).each(function(){e("<div class='ui-draggable-iframeFix' style='background: #fff;'></div>").css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(e(this).offset()).appendTo("body")}),!0):!1)},_mouseStart:function(t){var n=this.options;return this.helper=this._createHelper(t),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),e.ui.ddmanager&&(e.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offsetParent=this.helper.offsetParent(),this.offsetParentCssPosition=this.offsetParent.css("position"),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},this.offset.scroll=!1,e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,n.cursorAt&&this._adjustOffsetFromHelper(n.cursorAt),this._setContainment(),this._trigger("start",t)===!1?(this._clear(),!1):(this._cacheHelperProportions(),e.ui.ddmanager&&!n.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this._mouseDrag(t,!0),e.ui.ddmanager&&e.ui.ddmanager.dragStart(this,t),!0)},_mouseDrag:function(t,n){if("fixed"===this.offsetParentCssPosition&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),!n){var r=this._uiHash();if(this._trigger("drag",t,r)===!1)return this._mouseUp({}),!1;this.position=r.position}return this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),!1},_mouseStop:function(t){var n=this,r=!1;return e.ui.ddmanager&&!this.options.dropBehaviour&&(r=e.ui.ddmanager.drop(this,t)),this.dropped&&(r=this.dropped,this.dropped=!1),"original"!==this.options.helper||e.contains(this.element[0].ownerDocument,this.element[0])?("invalid"===this.options.revert&&!r||"valid"===this.options.revert&&r||this.options.revert===!0||e.isFunction(this.options.revert)&&this.options.revert.call(this.element,r)?e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){n._trigger("stop",t)!==!1&&n._clear()}):this._trigger("stop",t)!==!1&&this._clear(),!1):!1},_mouseUp:function(t){return e("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),e.ui.ddmanager&&e.ui.ddmanager.dragStop(this,t),e.ui.mouse.prototype._mouseUp.call(this,t)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(t){return this.options.handle?!!e(t.target).closest(this.element.find(this.options.handle)).length:!0},_createHelper:function(t){var n=this.options,r=e.isFunction(n.helper)?e(n.helper.apply(this.element[0],[t])):"clone"===n.helper?this.element.clone().removeAttr("id"):this.element;return r.parents("body").length||r.appendTo("parent"===n.appendTo?this.element[0].parentNode:n.appendTo),r[0]===this.element[0]||/(fixed|absolute)/.test(r.css("position"))||r.css("position","absolute"),r},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){var t=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&e.ui.ie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var e=this.element.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,n,r,i=this.options;return i.containment?"window"===i.containment?(this.containment=[e(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,e(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,e(window).scrollLeft()+e(window).width()-this.helperProportions.width-this.margins.left,e(window).scrollTop()+(e(window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],undefined):"document"===i.containment?(this.containment=[0,0,e(document).width()-this.helperProportions.width-this.margins.left,(e(document).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],undefined):i.containment.constructor===Array?(this.containment=i.containment,undefined):("parent"===i.containment&&(i.containment=this.helper[0].parentNode),n=e(i.containment),r=n[0],r&&(t="hidden"!==n.css("overflow"),this.containment=[(parseInt(n.css("borderLeftWidth"),10)||0)+(parseInt(n.css("paddingLeft"),10)||0),(parseInt(n.css("borderTopWidth"),10)||0)+(parseInt(n.css("paddingTop"),10)||0),(t?Math.max(r.scrollWidth,r.offsetWidth):r.offsetWidth)-(parseInt(n.css("borderRightWidth"),10)||0)-(parseInt(n.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(t?Math.max(r.scrollHeight,r.offsetHeight):r.offsetHeight)-(parseInt(n.css("borderBottomWidth"),10)||0)-(parseInt(n.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=n),undefined):(this.containment=null,undefined)},_convertPositionTo:function(t,n){n||(n=this.position);var r="absolute"===t?1:-1,i="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent;return this.offset.scroll||(this.offset.scroll={top:i.scrollTop(),left:i.scrollLeft()}),{top:n.top+this.offset.relative.top*r+this.offset.parent.top*r-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():this.offset.scroll.top)*r,left:n.left+this.offset.relative.left*r+this.offset.parent.left*r-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():this.offset.scroll.left)*r}},_generatePosition:function(t){var n,r,i,s,o=this.options,u="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,a=t.pageX,f=t.pageY;return this.offset.scroll||(this.offset.scroll={top:u.scrollTop(),left:u.scrollLeft()}),this.originalPosition&&(this.containment&&(this.relative_container?(r=this.relative_container.offset(),n=[this.containment[0]+r.left,this.containment[1]+r.top,this.containment[2]+r.left,this.containment[3]+r.top]):n=this.containment,t.pageX-this.offset.click.left<n[0]&&(a=n[0]+this.offset.click.left),t.pageY-this.offset.click.top<n[1]&&(f=n[1]+this.offset.click.top),t.pageX-this.offset.click.left>n[2]&&(a=n[2]+this.offset.click.left),t.pageY-this.offset.click.top>n[3]&&(f=n[3]+this.offset.click.top)),o.grid&&(i=o.grid[1]?this.originalPageY+Math.round((f-this.originalPageY)/o.grid[1])*o.grid[1]:this.originalPageY,f=n?i-this.offset.click.top>=n[1]||i-this.offset.click.top>n[3]?i:i-this.offset.click.top>=n[1]?i-o.grid[1]:i+o.grid[1]:i,s=o.grid[0]?this.originalPageX+Math.round((a-this.originalPageX)/o.grid[0])*o.grid[0]:this.originalPageX,a=n?s-this.offset.click.left>=n[0]||s-this.offset.click.left>n[2]?s:s-this.offset.click.left>=n[0]?s-o.grid[0]:s+o.grid[0]:s)),{top:f-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():this.offset.scroll.top),left:a-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():this.offset.scroll.left)}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(t,n,r){return r=r||this._uiHash(),e.ui.plugin.call(this,t,[n,r]),"drag"===t&&(this.positionAbs=this._convertPositionTo("absolute")),e.Widget.prototype._trigger.call(this,t,n,r)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),e.ui.plugin.add("draggable","connectToSortable",{start:function(t,n){var r=e(this).data("ui-draggable"),i=r.options,s=e.extend({},n,{item:r.element});r.sortables=[],e(i.connectToSortable).each(function(){var n=e.data(this,"ui-sortable");n&&!n.options.disabled&&(r.sortables.push({instance:n,shouldRevert:n.options.revert}),n.refreshPositions(),n._trigger("activate",t,s))})},stop:function(t,n){var r=e(this).data("ui-draggable"),i=e.extend({},n,{item:r.element});e.each(r.sortables,function(){this.instance.isOver?(this.instance.isOver=0,r.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=this.shouldRevert),this.instance._mouseStop(t),this.instance.options.helper=this.instance.options._helper,"original"===r.options.helper&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",t,i))})},drag:function(t,n){var r=e(this).data("ui-draggable"),i=this;e.each(r.sortables,function(){var o=!1,u=this;this.instance.positionAbs=r.positionAbs,this.instance.helperProportions=r.helperProportions,this.instance.offset.click=r.offset.click,this.instance._intersectsWith(this.instance.containerCache)&&(o=!0,e.each(r.sortables,function(){return this.instance.positionAbs=r.positionAbs,this.instance.helperProportions=r.helperProportions,this.instance.offset.click=r.offset.click,this!==u&&this.instance._intersectsWith(this.instance.containerCache)&&e.contains(u.instance.element[0],this.instance.element[0])&&(o=!1),o})),o?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=e(i).clone().removeAttr("id").appendTo(this.instance.element).data("ui-sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return n.helper[0]},t.target=this.instance.currentItem[0],this.instance._mouseCapture(t,!0),this.instance._mouseStart(t,!0,!0),this.instance.offset.click.top=r.offset.click.top,this.instance.offset.click.left=r.offset.click.left,this.instance.offset.parent.left-=r.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=r.offset.parent.top-this.instance.offset.parent.top,r._trigger("toSortable",t),r.dropped=this.instance.element,r.currentItem=r.element,this.instance.fromOutside=r),this.instance.currentItem&&this.instance._mouseDrag(t)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",t,this.instance._uiHash(this.instance)),this.instance._mouseStop(t,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),r._trigger("fromSortable",t),r.dropped=!1)})}}),e.ui.plugin.add("draggable","cursor",{start:function(){var t=e("body"),n=e(this).data("ui-draggable").options;t.css("cursor")&&(n._cursor=t.css("cursor")),t.css("cursor",n.cursor)},stop:function(){var t=e(this).data("ui-draggable").options;t._cursor&&e("body").css("cursor",t._cursor)}}),e.ui.plugin.add("draggable","opacity",{start:function(t,n){var r=e(n.helper),i=e(this).data("ui-draggable").options;r.css("opacity")&&(i._opacity=r.css("opacity")),r.css("opacity",i.opacity)},stop:function(t,n){var r=e(this).data("ui-draggable").options;r._opacity&&e(n.helper).css("opacity",r._opacity)}}),e.ui.plugin.add("draggable","scroll",{start:function(){var t=e(this).data("ui-draggable");t.scrollParent[0]!==document&&"HTML"!==t.scrollParent[0].tagName&&(t.overflowOffset=t.scrollParent.offset())},drag:function(t){var n=e(this).data("ui-draggable"),r=n.options,i=!1;n.scrollParent[0]!==document&&"HTML"!==n.scrollParent[0].tagName?(r.axis&&"x"===r.axis||(n.overflowOffset.top+n.scrollParent[0].offsetHeight-t.pageY<r.scrollSensitivity?n.scrollParent[0].scrollTop=i=n.scrollParent[0].scrollTop+r.scrollSpeed:t.pageY-n.overflowOffset.top<r.scrollSensitivity&&(n.scrollParent[0].scrollTop=i=n.scrollParent[0].scrollTop-r.scrollSpeed)),r.axis&&"y"===r.axis||(n.overflowOffset.left+n.scrollParent[0].offsetWidth-t.pageX<r.scrollSensitivity?n.scrollParent[0].scrollLeft=i=n.scrollParent[0].scrollLeft+r.scrollSpeed:t.pageX-n.overflowOffset.left<r.scrollSensitivity&&(n.scrollParent[0].scrollLeft=i=n.scrollParent[0].scrollLeft-r.scrollSpeed))):(r.axis&&"x"===r.axis||(t.pageY-e(document).scrollTop()<r.scrollSensitivity?i=e(document).scrollTop(e(document).scrollTop()-r.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<r.scrollSensitivity&&(i=e(document).scrollTop(e(document).scrollTop()+r.scrollSpeed))),r.axis&&"y"===r.axis||(t.pageX-e(document).scrollLeft()<r.scrollSensitivity?i=e(document).scrollLeft(e(document).scrollLeft()-r.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<r.scrollSensitivity&&(i=e(document).scrollLeft(e(document).scrollLeft()+r.scrollSpeed)))),i!==!1&&e.ui.ddmanager&&!r.dropBehaviour&&e.ui.ddmanager.prepareOffsets(n,t)}}),e.ui.plugin.add("draggable","snap",{start:function(){var t=e(this).data("ui-draggable"),n=t.options;t.snapElements=[],e(n.snap.constructor!==String?n.snap.items||":data(ui-draggable)":n.snap).each(function(){var n=e(this),r=n.offset();this!==t.element[0]&&t.snapElements.push({item:this,width:n.outerWidth(),height:n.outerHeight(),top:r.top,left:r.left})})},drag:function(t,n){var r,i,s,o,u,a,f,l,c,h,p=e(this).data("ui-draggable"),d=p.options,v=d.snapTolerance,m=n.offset.left,g=m+p.helperProportions.width,y=n.offset.top,b=y+p.helperProportions.height;for(c=p.snapElements.length-1;c>=0;c--)u=p.snapElements[c].left,a=u+p.snapElements[c].width,f=p.snapElements[c].top,l=f+p.snapElements[c].height,u-v>g||m>a+v||f-v>b||y>l+v||!e.contains(p.snapElements[c].item.ownerDocument,p.snapElements[c].item)?(p.snapElements[c].snapping&&p.options.snap.release&&p.options.snap.release.call(p.element,t,e.extend(p._uiHash(),{snapItem:p.snapElements[c].item})),p.snapElements[c].snapping=!1):("inner"!==d.snapMode&&(r=v>=Math.abs(f-b),i=v>=Math.abs(l-y),s=v>=Math.abs(u-g),o=v>=Math.abs(a-m),r&&(n.position.top=p._convertPositionTo("relative",{top:f-p.helperProportions.height,left:0}).top-p.margins.top),i&&(n.position.top=p._convertPositionTo("relative",{top:l,left:0}).top-p.margins.top),s&&(n.position.left=p._convertPositionTo("relative",{top:0,left:u-p.helperProportions.width}).left-p.margins.left),o&&(n.position.left=p._convertPositionTo("relative",{top:0,left:a}).left-p.margins.left)),h=r||i||s||o,"outer"!==d.snapMode&&(r=v>=Math.abs(f-y),i=v>=Math.abs(l-b),s=v>=Math.abs(u-m),o=v>=Math.abs(a-g),r&&(n.position.top=p._convertPositionTo("relative",{top:f,left:0}).top-p.margins.top),i&&(n.position.top=p._convertPositionTo("relative",{top:l-p.helperProportions.height,left:0}).top-p.margins.top),s&&(n.position.left=p._convertPositionTo("relative",{top:0,left:u}).left-p.margins.left),o&&(n.position.left=p._convertPositionTo("relative",{top:0,left:a-p.helperProportions.width}).left-p.margins.left)),!p.snapElements[c].snapping&&(r||i||s||o||h)&&p.options.snap.snap&&p.options.snap.snap.call(p.element,t,e.extend(p._uiHash(),{snapItem:p.snapElements[c].item})),p.snapElements[c].snapping=r||i||s||o||h)}}),e.ui.plugin.add("draggable","stack",{start:function(){var t,n=this.data("ui-draggable").options,r=e.makeArray(e(n.stack)).sort(function(t,n){return(parseInt(e(t).css("zIndex"),10)||0)-(parseInt(e(n).css("zIndex"),10)||0)});r.length&&(t=parseInt(e(r[0]).css("zIndex"),10)||0,e(r).each(function(n){e(this).css("zIndex",t+n)}),this.css("zIndex",t+r.length))}}),e.ui.plugin.add("draggable","zIndex",{start:function(t,n){var r=e(n.helper),i=e(this).data("ui-draggable").options;r.css("zIndex")&&(i._zIndex=r.css("zIndex")),r.css("zIndex",i.zIndex)},stop:function(t,n){var r=e(this).data("ui-draggable").options;r._zIndex&&e(n.helper).css("zIndex",r._zIndex)}})}(jQuery),function(e){function t(e){return parseInt(e,10)||0}function n(e){return!isNaN(parseInt(e,10))}e.widget("ui.resizable",e.ui.mouse,{version:"1.10.3",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_create:function(){var t,n,r,i,s,o=this,u=this.options;if(this.element.addClass("ui-resizable"),e.extend(this,{_aspectRatio:!!u.aspectRatio,aspectRatio:u.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:u.helper||u.ghost||u.animate?u.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)&&(this.element.wrap(e("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.data("ui-resizable")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize()),this.handles=u.handles||(e(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),t=this.handles.split(","),this.handles={},n=0;t.length>n;n++)r=e.trim(t[n]),s="ui-resizable-"+r,i=e("<div class='ui-resizable-handle "+s+"'></div>"),i.css({zIndex:u.zIndex}),"se"===r&&i.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),this.handles[r]=".ui-resizable-"+r,this.element.append(i);this._renderAxis=function(t){var n,r,i,s;t=t||this.element;for(n in this.handles)this.handles[n].constructor===String&&(this.handles[n]=e(this.handles[n],this.element).show()),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)&&(r=e(this.handles[n],this.element),s=/sw|ne|nw|se|n|s/.test(n)?r.outerHeight():r.outerWidth(),i=["padding",/ne|nw|n/.test(n)?"Top":/se|sw|s/.test(n)?"Bottom":/^e$/.test(n)?"Right":"Left"].join(""),t.css(i,s),this._proportionallyResize()),e(this.handles[n]).length},this._renderAxis(this.element),this._handles=e(".ui-resizable-handle",this.element).disableSelection(),this._handles.mouseover(function(){o.resizing||(this.className&&(i=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),o.axis=i&&i[1]?i[1]:"se")}),u.autoHide&&(this._handles.hide(),e(this.element).addClass("ui-resizable-autohide").mouseenter(function(){u.disabled||(e(this).removeClass("ui-resizable-autohide"),o._handles.show())}).mouseleave(function(){u.disabled||o.resizing||(e(this).addClass("ui-resizable-autohide"),o._handles.hide())})),this._mouseInit()},_destroy:function(){this._mouseDestroy();var t,n=function(t){e(t).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(n(this.element),t=this.element,this.originalElement.css({position:t.css("position"),width:t.outerWidth(),height:t.outerHeight(),top:t.css("top"),left:t.css("left")}).insertAfter(t),t.remove()),this.originalElement.css("resize",this.originalResizeStyle),n(this.originalElement),this},_mouseCapture:function(t){var n,r,i=!1;for(n in this.handles)r=e(this.handles[n])[0],(r===t.target||e.contains(r,t.target))&&(i=!0);return!this.options.disabled&&i},_mouseStart:function(n){var r,i,s,o=this.options,u=this.element.position(),a=this.element;return this.resizing=!0,/absolute/.test(a.css("position"))?a.css({position:"absolute",top:a.css("top"),left:a.css("left")}):a.is(".ui-draggable")&&a.css({position:"absolute",top:u.top,left:u.left}),this._renderProxy(),r=t(this.helper.css("left")),i=t(this.helper.css("top")),o.containment&&(r+=e(o.containment).scrollLeft()||0,i+=e(o.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:r,top:i},this.size=this._helper?{width:a.outerWidth(),height:a.outerHeight()}:{width:a.width(),height:a.height()},this.originalSize=this._helper?{width:a.outerWidth(),height:a.outerHeight()}:{width:a.width(),height:a.height()},this.originalPosition={left:r,top:i},this.sizeDiff={width:a.outerWidth()-a.width(),height:a.outerHeight()-a.height()},this.originalMousePosition={left:n.pageX,top:n.pageY},this.aspectRatio="number"==typeof o.aspectRatio?o.aspectRatio:this.originalSize.width/this.originalSize.height||1,s=e(".ui-resizable-"+this.axis).css("cursor"),e("body").css("cursor","auto"===s?this.axis+"-resize":s),a.addClass("ui-resizable-resizing"),this._propagate("start",n),!0},_mouseDrag:function(t){var n,r=this.helper,i={},s=this.originalMousePosition,o=this.axis,u=this.position.top,a=this.position.left,f=this.size.width,l=this.size.height,c=t.pageX-s.left||0,h=t.pageY-s.top||0,p=this._change[o];return p?(n=p.apply(this,[t,c,h]),this._updateVirtualBoundaries(t.shiftKey),(this._aspectRatio||t.shiftKey)&&(n=this._updateRatio(n,t)),n=this._respectSize(n,t),this._updateCache(n),this._propagate("resize",t),this.position.top!==u&&(i.top=this.position.top+"px"),this.position.left!==a&&(i.left=this.position.left+"px"),this.size.width!==f&&(i.width=this.size.width+"px"),this.size.height!==l&&(i.height=this.size.height+"px"),r.css(i),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),e.isEmptyObject(i)||this._trigger("resize",t,this.ui()),!1):!1},_mouseStop:function(t){this.resizing=!1;var n,r,i,s,o,u,a,f=this.options,l=this;return this._helper&&(n=this._proportionallyResizeElements,r=n.length&&/textarea/i.test(n[0].nodeName),i=r&&e.ui.hasScroll(n[0],"left")?0:l.sizeDiff.height,s=r?0:l.sizeDiff.width,o={width:l.helper.width()-s,height:l.helper.height()-i},u=parseInt(l.element.css("left"),10)+(l.position.left-l.originalPosition.left)||null,a=parseInt(l.element.css("top"),10)+(l.position.top-l.originalPosition.top)||null,f.animate||this.element.css(e.extend(o,{top:a,left:u})),l.helper.height(l.size.height),l.helper.width(l.size.width),this._helper&&!f.animate&&this._proportionallyResize()),e("body").css("cursor","auto"),this.element.removeClass("ui-resizable-resizing"),this._propagate("stop",t),this._helper&&this.helper.remove(),!1},_updateVirtualBoundaries:function(e){var t,r,s,o,u,a=this.options;u={minWidth:n(a.minWidth)?a.minWidth:0,maxWidth:n(a.maxWidth)?a.maxWidth:1/0,minHeight:n(a.minHeight)?a.minHeight:0,maxHeight:n(a.maxHeight)?a.maxHeight:1/0},(this._aspectRatio||e)&&(t=u.minHeight*this.aspectRatio,s=u.minWidth/this.aspectRatio,r=u.maxHeight*this.aspectRatio,o=u.maxWidth/this.aspectRatio,t>u.minWidth&&(u.minWidth=t),s>u.minHeight&&(u.minHeight=s),u.maxWidth>r&&(u.maxWidth=r),u.maxHeight>o&&(u.maxHeight=o)),this._vBoundaries=u},_updateCache:function(e){this.offset=this.helper.offset(),n(e.left)&&(this.position.left=e.left),n(e.top)&&(this.position.top=e.top),n(e.height)&&(this.size.height=e.height),n(e.width)&&(this.size.width=e.width)},_updateRatio:function(e){var t=this.position,r=this.size,s=this.axis;return n(e.height)?e.width=e.height*this.aspectRatio:n(e.width)&&(e.height=e.width/this.aspectRatio),"sw"===s&&(e.left=t.left+(r.width-e.width),e.top=null),"nw"===s&&(e.top=t.top+(r.height-e.height),e.left=t.left+(r.width-e.width)),e},_respectSize:function(e){var t=this._vBoundaries,r=this.axis,s=n(e.width)&&t.maxWidth&&t.maxWidth<e.width,o=n(e.height)&&t.maxHeight&&t.maxHeight<e.height,u=n(e.width)&&t.minWidth&&t.minWidth>e.width,a=n(e.height)&&t.minHeight&&t.minHeight>e.height,f=this.originalPosition.left+this.originalSize.width,l=this.position.top+this.size.height,c=/sw|nw|w/.test(r),h=/nw|ne|n/.test(r);return u&&(e.width=t.minWidth),a&&(e.height=t.minHeight),s&&(e.width=t.maxWidth),o&&(e.height=t.maxHeight),u&&c&&(e.left=f-t.minWidth),s&&c&&(e.left=f-t.maxWidth),a&&h&&(e.top=l-t.minHeight),o&&h&&(e.top=l-t.maxHeight),e.width||e.height||e.left||!e.top?e.width||e.height||e.top||!e.left||(e.left=null):e.top=null,e},_proportionallyResize:function(){if(this._proportionallyResizeElements.length){var e,t,n,r,i,s=this.helper||this.element;for(e=0;this._proportionallyResizeElements.length>e;e++){if(i=this._proportionallyResizeElements[e],!this.borderDif)for(this.borderDif=[],n=[i.css("borderTopWidth"),i.css("borderRightWidth"),i.css("borderBottomWidth"),i.css("borderLeftWidth")],r=[i.css("paddingTop"),i.css("paddingRight"),i.css("paddingBottom"),i.css("paddingLeft")],t=0;n.length>t;t++)this.borderDif[t]=(parseInt(n[t],10)||0)+(parseInt(r[t],10)||0);i.css({height:s.height()-this.borderDif[0]-this.borderDif[2]||0,width:s.width()-this.borderDif[1]-this.borderDif[3]||0})}}},_renderProxy:function(){var t=this.element,n=this.options;this.elementOffset=t.offset(),this._helper?(this.helper=this.helper||e("<div style='overflow:hidden;'></div>"),this.helper.addClass(this._helper).css({width:this.element.outerWidth()-1,height:this.element.outerHeight()-1,position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++n.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(e,t){return{width:this.originalSize.width+t}},w:function(e,t){var n=this.originalSize,r=this.originalPosition;return{left:r.left+t,width:n.width-t}},n:function(e,t,n){var r=this.originalSize,i=this.originalPosition;return{top:i.top+n,height:r.height-n}},s:function(e,t,n){return{height:this.originalSize.height+n}},se:function(t,n,r){return e.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[t,n,r]))},sw:function(t,n,r){return e.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[t,n,r]))},ne:function(t,n,r){return e.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[t,n,r]))},nw:function(t,n,r){return e.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[t,n,r]))}},_propagate:function(t,n){e.ui.plugin.call(this,t,[n,this.ui()]),"resize"!==t&&this._trigger(t,n,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),e.ui.plugin.add("resizable","animate",{stop:function(t){var n=e(this).data("ui-resizable"),r=n.options,i=n._proportionallyResizeElements,s=i.length&&/textarea/i.test(i[0].nodeName),o=s&&e.ui.hasScroll(i[0],"left")?0:n.sizeDiff.height,u=s?0:n.sizeDiff.width,a={width:n.size.width-u,height:n.size.height-o},f=parseInt(n.element.css("left"),10)+(n.position.left-n.originalPosition.left)||null,l=parseInt(n.element.css("top"),10)+(n.position.top-n.originalPosition.top)||null;n.element.animate(e.extend(a,l&&f?{top:l,left:f}:{}),{duration:r.animateDuration,easing:r.animateEasing,step:function(){var r={width:parseInt(n.element.css("width"),10),height:parseInt(n.element.css("height"),10),top:parseInt(n.element.css("top"),10),left:parseInt(n.element.css("left"),10)};i&&i.length&&e(i[0]).css({width:r.width,height:r.height}),n._updateCache(r),n._propagate("resize",t)}})}}),e.ui.plugin.add("resizable","containment",{start:function(){var n,r,i,s,o,u,a,f=e(this).data("ui-resizable"),l=f.options,c=f.element,h=l.containment,p=h instanceof e?h.get(0):/parent/.test(h)?c.parent().get(0):h;p&&(f.containerElement=e(p),/document/.test(h)||h===document?(f.containerOffset={left:0,top:0},f.containerPosition={left:0,top:0},f.parentData={element:e(document),left:0,top:0,width:e(document).width(),height:e(document).height()||document.body.parentNode.scrollHeight}):(n=e(p),r=[],e(["Top","Right","Left","Bottom"]).each(function(e,i){r[e]=t(n.css("padding"+i))}),f.containerOffset=n.offset(),f.containerPosition=n.position(),f.containerSize={height:n.innerHeight()-r[3],width:n.innerWidth()-r[1]},i=f.containerOffset,s=f.containerSize.height,o=f.containerSize.width,u=e.ui.hasScroll(p,"left")?p.scrollWidth:o,a=e.ui.hasScroll(p)?p.scrollHeight:s,f.parentData={element:p,left:i.left,top:i.top,width:u,height:a}))},resize:function(t){var n,r,i,s,o=e(this).data("ui-resizable"),u=o.options,a=o.containerOffset,f=o.position,l=o._aspectRatio||t.shiftKey,c={top:0,left:0},h=o.containerElement;h[0]!==document&&/static/.test(h.css("position"))&&(c=a),f.left<(o._helper?a.left:0)&&(o.size.width=o.size.width+(o._helper?o.position.left-a.left:o.position.left-c.left),l&&(o.size.height=o.size.width/o.aspectRatio),o.position.left=u.helper?a.left:0),f.top<(o._helper?a.top:0)&&(o.size.height=o.size.height+(o._helper?o.position.top-a.top:o.position.top),l&&(o.size.width=o.size.height*o.aspectRatio),o.position.top=o._helper?a.top:0),o.offset.left=o.parentData.left+o.position.left,o.offset.top=o.parentData.top+o.position.top,n=Math.abs((o._helper?o.offset.left-c.left:o.offset.left-c.left)+o.sizeDiff.width),r=Math.abs((o._helper?o.offset.top-c.top:o.offset.top-a.top)+o.sizeDiff.height),i=o.containerElement.get(0)===o.element.parent().get(0),s=/relative|absolute/.test(o.containerElement.css("position")),i&&s&&(n-=o.parentData.left),n+o.size.width>=o.parentData.width&&(o.size.width=o.parentData.width-n,l&&(o.size.height=o.size.width/o.aspectRatio)),r+o.size.height>=o.parentData.height&&(o.size.height=o.parentData.height-r,l&&(o.size.width=o.size.height*o.aspectRatio))},stop:function(){var t=e(this).data("ui-resizable"),n=t.options,r=t.containerOffset,i=t.containerPosition,s=t.containerElement,o=e(t.helper),u=o.offset(),a=o.outerWidth()-t.sizeDiff.width,f=o.outerHeight()-t.sizeDiff.height;t._helper&&!n.animate&&/relative/.test(s.css("position"))&&e(this).css({left:u.left-i.left-r.left,width:a,height:f}),t._helper&&!n.animate&&/static/.test(s.css("position"))&&e(this).css({left:u.left-i.left-r.left,width:a,height:f})}}),e.ui.plugin.add("resizable","alsoResize",{start:function(){var t=e(this).data("ui-resizable"),n=t.options,r=function(t){e(t).each(function(){var t=e(this);t.data("ui-resizable-alsoresize",{width:parseInt(t.width(),10),height:parseInt(t.height(),10),left:parseInt(t.css("left"),10),top:parseInt(t.css("top"),10)})})};"object"!=typeof n.alsoResize||n.alsoResize.parentNode?r(n.alsoResize):n.alsoResize.length?(n.alsoResize=n.alsoResize[0],r(n.alsoResize)):e.each(n.alsoResize,function(e){r(e)})},resize:function(t,n){var r=e(this).data("ui-resizable"),i=r.options,s=r.originalSize,o=r.originalPosition,u={height:r.size.height-s.height||0,width:r.size.width-s.width||0,top:r.position.top-o.top||0,left:r.position.left-o.left||0},a=function(t,r){e(t).each(function(){var t=e(this),i=e(this).data("ui-resizable-alsoresize"),s={},o=r&&r.length?r:t.parents(n.originalElement[0]).length?["width","height"]:["width","height","top","left"];e.each(o,function(e,t){var n=(i[t]||0)+(u[t]||0);n&&n>=0&&(s[t]=n||null)}),t.css(s)})};"object"!=typeof i.alsoResize||i.alsoResize.nodeType?a(i.alsoResize):e.each(i.alsoResize,function(e,t){a(e,t)})},stop:function(){e(this).removeData("resizable-alsoresize")}}),e.ui.plugin.add("resizable","ghost",{start:function(){var t=e(this).data("ui-resizable"),n=t.options,r=t.size;t.ghost=t.originalElement.clone(),t.ghost.css({opacity:.25,display:"block",position:"relative",height:r.height,width:r.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass("string"==typeof n.ghost?n.ghost:""),t.ghost.appendTo(t.helper)},resize:function(){var t=e(this).data("ui-resizable");t.ghost&&t.ghost.css({position:"relative",height:t.size.height,width:t.size.width})},stop:function(){var t=e(this).data("ui-resizable");t.ghost&&t.helper&&t.helper.get(0).removeChild(t.ghost.get(0))}}),e.ui.plugin.add("resizable","grid",{resize:function(){var t=e(this).data("ui-resizable"),n=t.options,r=t.size,i=t.originalSize,s=t.originalPosition,o=t.axis,u="number"==typeof n.grid?[n.grid,n.grid]:n.grid,a=u[0]||1,f=u[1]||1,l=Math.round((r.width-i.width)/a)*a,c=Math.round((r.height-i.height)/f)*f,h=i.width+l,p=i.height+c,d=n.maxWidth&&h>n.maxWidth,v=n.maxHeight&&p>n.maxHeight,m=n.minWidth&&n.minWidth>h,g=n.minHeight&&n.minHeight>p;n.grid=u,m&&(h+=a),g&&(p+=f),d&&(h-=a),v&&(p-=f),/^(se|s|e)$/.test(o)?(t.size.width=h,t.size.height=p):/^(ne)$/.test(o)?(t.size.width=h,t.size.height=p,t.position.top=s.top-c):/^(sw)$/.test(o)?(t.size.width=h,t.size.height=p,t.position.left=s.left-l):(t.size.width=h,t.size.height=p,t.position.top=s.top-c,t.position.left=s.left-l)}})}(jQuery),define("jqueryui",function(){}),define("views/Calendar",["jquery","underscore","backbone","rrule","views/EventEditor","models/Event","collections/Events","moment","modules/Backbone.sync","fullCalendar","bootstrap","jqueryui","qtip","datepicker","shortcuts"],function(e,t,n,r,i,s,o,u){var a=n.View.extend({initialize:function(){var t=this;this.$el=e("<div/>").qtip({id:"tooltip",prerender:!0,content:{text:"",title:"New Event",button:"Close"},position:{my:"bottom center",at:"top center",viewport:e(window),target:"event"},events:{render:function(t,n){e(window).on("keydown",function(e){e.keyCode===27&&n.hide(e)})},hide:function(e,n){n.elements.tooltip.stop(1,1),t.calendarView.$el.fullCalendar("unselect")}},hide:!1,style:"qtip-bootstrap"}).qtip("api")},render:function(e){this.$el.elements.tooltip.stop(1,1),this.$el.reposition(e).toggle(!0,e),this.listener()},set:function(e,t,n,r){this.start=e,this.end=t,this.allDay=n,this.$el.set({"content.text":r})},isBlank:function(e){return/^\s*$/.test(e)},hide:function(){this.$el.toggle(!1)},generateId:function(){return(new Date).getTime().toString()},listener:function(){function a(){var e=r.val();if(t.isBlank(e)){alert("Event title cannot be an empty or blank string.");return}var n={_id:t.generateId(),title:e,allDay:t.allDay,start:t.start,end:t.end,rrule:null,last_modified:new Date};t.collection.create(new s(n),{success:t.hide()}),console.log(t.collection.toJSON())}var t=this,n=e("#qtip-tooltip"),r=n.find("#tooltip-title-input").focus(),i=n.find("#tooltip-create-event"),o=n.find("#tooltip-cancel"),u=n.find("#advanced-edit");i.on("click",a),r.on("keydown",function(e){e.keyCode===13&&a()}),u.on("click",function(){var e=r.val(),n={_id:null,title:e,allDay:t.allDay,start:t.start,end:t.end,rrule:null,last_modified:null};t.calendarView.hideView(),t.eventEditorView.model=new s(n),t.eventEditorView.render(),t.hide()}),o.on("click",function(){t.hide()})}}),f=n.View.extend({el:"#dialog",initialize:function(e){this.$el.modal({backdrop:!1}),this.event=e.toJSON(),this.render(),this.show()},render:function(){var n=t.template(e("#infoDialogTemplate").html(),{event:this.event});this.$(".modal-content").html(n)},show:function(){this.$el.modal("show")}});return n.View.extend({el:"#calendar",shortcuts:{w:"weekView",d:"dayView",m:"monthView",t:"today",up:"scrollUp",down:"scrollDown",left:"nextPage",right:"prePage"},initialize:function(){t.bindAll(this,"select","unselect","loading","eventRender","eventDragStart","eventResizeStart","eventDrop","eventResize","eventClick","viewDisplay"),this.eventResizing=!1,this.elementArray=[],this.tooltip=new a,this.eventEditorView=new i,t.extend(this,new n.Shortcuts),this.delegateShortcuts(),this.render()},render:function(){var t=this;this.$el.fullCalendar({header:{left:"prev,next today title",right:"month,agendaWeek,agendaDay"},height:e(window).height()-10,timeFormat:"h:mmtt{ - h:mmtt}",editable:!0,selectable:!0,selectHelper:!0,select:this.select,slotMinutes:30,unselect:this.unselect,unselectCancel:".qtip",loading:this.loading,eventResizeStart:this.eventResizeStart,eventDragStart:this.eventDragStart,eventClick:this.eventClick,eventDrop:this.eventDrop,eventResize:this.eventResize,eventRender:this.eventRender,eventAfterAllRender:this.eventAfterAllRender,viewDisplay:this.viewDisplay}),this.tooltip.collection=this.eventEditorView.collection=this.collection,this.tooltip.calendarView=this.eventEditorView.calendarView=this,this.tooltip.eventEditorView=this.eventEditorView,e("#mini-calendar").datepicker({autoclose:!0}).on("changeDate",function(e){t.$el.fullCalendar("gotoDate",e.date),t.$el.fullCalendar("changeView","agendaDay")}),this.resizeCalendar(),this.agendaTable=e("table.fc-agenda-slots:visible").parent().parent(),this.collection.fetch({success:function(e){console.log(e.toJSON()),t.listenTo(t.collection,"add update destroy",function(e){var n=e.get("id"),r=e.get("rrule");t.$el.fullCalendar("refetchEvents")}),t.renderEvents()}}),this.on("show",this.showView),e(window).on("resize",function(){if(t.eventResizing)return;t.resizeCalendar(),t.destroyQtip(),t.$el.fullCalendar("rerenderEvents")})},weekView:function(){this.$el.fullCalendar("changeView","agendaWeek"),this.hideQtip()},dayView:function(){this.$el.fullCalendar("changeView","agendaDay"),this.hideQtip()},monthView:function(){this.$el.fullCalendar("changeView","month"),this.hideQtip()},today:function(){this.$el.fullCalendar("today")},scrollUp:function(){var t=e("table.fc-agenda-slots:visible").parent().parent();t.scrollTop(t.scrollTop()-42)},scrollDown:function(){var t=e("table.fc-agenda-slots:visible").parent().parent();t.scrollTop(t.scrollTop()+42)},nextPage:function(){this.$el.fullCalendar("next")},prePage:function(){this.$el.fullCalendar("prev")},showView:function(){this.$el.show(),this.resizeCalendar()},hideView:function(){e("#main-panel").hide()},resizeCalendar:function(){this.$el.fullCalendar("option","height",e(window).height()-10)},renderEvents:function(){var e=this,n={events:function(n,i,s){var o=[],u=[];e.collection.filter(function(e){e.get("rrule")==null?o.push(e.toJSON()):u.push(e.toJSON())});for(var a=u.length-1;a>=0;a--){var f=u[a],l=new r(f.rrule),c=l.between(n,i,!0),h=f.end?f.end.getTime()-f.start.getTime():0;for(var p=c.length-1;p>=0;p--){var d=t.clone(f);d.start=c[p],d.end=new Date(d.start.getTime()+h),e.$el.fullCalendar("renderEvent",d)}}s(o)},color:"",textColor:""};this.$el.fullCalendar("addEventSource",n)},select:function(e,t,n,r){var i=this,s=this.getPopoverFormat(e,t,n),o='<table><tbody><tr><th>Date:  </th><td id="tooltip-date">'+s.startTime+s.endTime+"</td>"+"</tr>"+"<tr>"+"<th>Title: </th>"+'<td><input id="tooltip-title-input" type="text" class="form-control"></td>'+"</tr>"+"<tr>"+'<td colspan="2">'+'<button id="tooltip-create-event" type="button" class="btn btn-xs btn-primary">Create</button>'+'<button id="tooltip-cancel" type="button" class="btn btn-xs btn-default">Cancel</button>'+'<a href="javascript:void(0)" id="advanced-edit">Advanced Edit</a>'+"</td>"+"</tr>"+"</tbody>"+"</table>";this.tooltip.set(e,t,n,o),this.tooltip.render(r)},unselect:function(){this.hideTooltip()},loading:function(e){e},eventClick:function(e){var t=this.collection.get(e._id),n=this.getPopoverFormat(e.start,e.end,e.allDay);t.set("date",n.startTime+(e.end&&n.endTime||"")),this.hideQtip(e),new f(t)},eventDrop:function(e,t,n,r,i){this.eventDropOrResize(e,i)},eventResize:function(e,t,n,r){this.eventDropOrResize(e,r),this.eventResizing=!1},eventDropOrResize:function(e,n){var r=this.collection.get(e._id),i=r.get("rrule");t.isNull(i)||(i.dtstart=e.start),this.collection.get(e._id).save({start:e.start,end:e.end,rrule:i})},eventResizeStart:function(e){this.hideQtip(e),this.eventResizing=!0},eventDragStart:function(e){this.hideQtip(e)},viewDisplay:function(){function i(){var t=new Date;if(t.getHours()==0&&t.getMinutes()<=5){var r=e(".fc-today");r.removeClass("fc-today"),r.removeClass("fc-state-highlight"),r.next().addClass("fc-today"),r.next().addClass("fc-state-highlight")}var i=e(".fc-agenda-slots:visible").parent(),s=i.children(".timeline"),o=t.getHours(),a=u().format("h:mm:ss a"),f='<span style="position:absolute;'+(o>12&&"margin-top:-23px")+'">'+a+"</span>";s.length==0&&(s=e("<div>").addClass("timeline").html(f),i.prepend(s));var l=n.fullCalendar("getView");l.visStart<t&&l.visEnd>t?s.show():s.hide();var c=t.getHours()*60*60+t.getMinutes()*60+t.getSeconds(),h=c/86400,p=Math.floor(i.height()*h);s.css({top:p+"px","padding-bottom":"10px"}).html(f);if(l.name=="agendaWeek"){var d=e(".fc-today:visible");if(d.position()!=null){var v=d.position().left+1,m=d.width();s.css({left:v+"px",width:m+"px"})}}}t.isUndefined(this.timelineInterval)||window.clearInterval(this.timelineInterval);var n=this.$el;this.timelineInterval=window.setInterval(i,1e3);try{i(this.$el)}catch(r){}},getPopoverFormat:function(t,n,r){var i=new Date(t),s=new Date(n),o="ddd, MMMM d",u="";if(n&&(!r||i.getDate()!=s.getDate())){u=" - ";if(i.getFullYear()!=s.getFullYear())u+=o+=", yyyy";else if(i.getDate()!=s.getDate()||i.getMonth()!=s.getMonth())u+=o}return r||(o+=", h(:mm)tt",u+="h(:mm)tt"),i=e.fullCalendar.formatDate(i,o),s=e.fullCalendar.formatDate(s,u),{startTime:i,endTime:s}},eventRender:function(n,r){var i=this;r.on("dblclick",function(){i.hideView(),i.eventEditorView.model=i.collection.get(n._id),i.eventEditorView.render()});var s=this.getPopoverFormat(n.start,n.end,n.allDay),o="<h3>"+n.title+"</h3>"+"<p><b>Date:</b> "+s.startTime+(n.end&&s.endTime||"")+"</p>",u=n._id+(n.rrule?"-"+n.start.getTime():"");t.isUndefined(this.elementArray[u])||this.elementArray[u].destroy(!0);var a=r.qtip({id:u,content:{title:n.title+'<div class="pull-right"><a class="qtip-edit" title="Edit" aria-label="Edit" role="button"><span class="glyphicon glyphicon-edit"></span></a><a class="qtip-delete" title="Delete" aria-label="Delete" role="button" style="margin-left: 5px"><span class="glyphicon glyphicon-trash"></span></a></div>',text:o},position:{my:"bottom center",at:"top center",viewport:e(window)},events:{render:function(t,n){var r=n.id.replace(/-.*/,"");e(this).on("click",".qtip-edit",function(){n.toggle(!1),i.hideView(),i.tooltip.hide(),i.eventEditorView.model=i.collection.get(r),i.eventEditorView.render()}),e(this).on("click",".qtip-delete",function(){confirm("Are you sure you want to delete this event?")&&i.collection.get(r).destroy({success:n.destroy(!0)})})}},hide:{fixed:!0,delay:100},style:"qtip-bootstrap"}).qtip("api");this.elementArray[u]=a},showAdvanceEditor:function(e){this.hideView(),this.eventEditorView.model=_this.collection.get(e),this.eventEditorView.render()},eventAfterAllRender:function(){},hideTooltip:function(){this.tooltip.hide()},hideQtip:function(e){for(var t=0,n=this.elementArray.length;t<n;t++)this.elementArray[t].hide()},destroyQtip:function(){var e;while(e=this.elementArray.pop())e.destroy(!0)}})}),define("routers/router",["jquery","underscore","backbone","views/Calendar","views/EventEditor","collections/Events"],function(e,t,n,r,i,s){return n.Router.extend({routes:{"*actions":"index",editor:"editor",catalog:""},initialize:function(){},index:function(){new r({collection:new s})},editor:function(){new i}})}),define("app",["jquery","backbone","routers/router"],function(e,t,n){return{init:function(){new n,t.history.start()},setupPrint:function(){var t=e("#calendar"),n=e("#mini-calendar").parent(),r=t.css("width"),i=function(){n.hide(),t.css("width","1010"),t.fullCalendar("render")},s=function(){n.show(),t.css("width",r),t.fullCalendar("render")};if(window.matchMedia){var o=window.matchMedia("print");o.addListener(function(e){e.matches?i():s()})}window.onbeforeprint=i,window.onafterprint=s}}}),requirejs.config({paths:{jquery:["http://cdnjs.cloudflare.com/ajax/libs/jquery/1.10.2/jquery.min","vendor/jquery/jquery.min"],jqueryui:"libs/jquery-ui.custom.min",underscore:["http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.5.2/underscore-min","vendor/underscore/underscore-min"],backbone:["http://cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.0/backbone-min","vendor/backbone/backbone-min"],bootstrap:["http://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.0.0/js/bootstrap.min","vendor/bootstrap/dist/js/bootstrap.min"],fullCalendar:["http://cdnjs.cloudflare.com/ajax/libs/fullcalendar/1.6.4/fullcalendar.min","vendor/fullcalendar/fullCalendar.min"],moment:["http://cdnjs.cloudflare.com/ajax/libs/moment.js/2.1.0/moment.min","vendor/momentjs/min/moment.min"],datepicker:["http://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.2.0/js/bootstrap-datepicker.min","vendor/bootstrap-datepicker/js/bootstrap-datepicker"],rrule:"libs/rrule",daterangepicker:"vendor/bootstrap-daterangepicker/daterangepicker",qtip:"vendor/qtip2/jquery.qtip.min",icheck:"vendor/jquery-icheck/jquery.icheck.min",bongo:"vendor/bongo.js/dist/bongo.min",keymaster:"libs/keymaster.min",shortcuts:"libs/backbone.shortcuts.min",templates:"../templates"},shim:{underscore:{exports:"_"},backbone:{deps:["underscore","jquery"],exports:"Backbone"},jqueryui:["jquery"],fullCalendar:["jquery"],bootstrap:["jquery"],daterangepicker:["jquery","moment"],datepicker:["jquery"],icheck:["jquery"],keymaster:{exports:"key"},shortcuts:["underscore","backbone","keymaster"]},urlArgs:"bust="+(new Date).getTime()}),requirejs(["app"],function(e){e.init(),e.setupPrint()}),define("main",function(){});